ggplot(plant_with_light, aes(x = weekly_avg_SlrW, y = daily_growth)) +
geom_point(alpha = 0.2) +
geom_smooth(method = "lm", color = "red") +
labs(title = "Figure B: Correlation between Light and Growth", x = "Weekly Avg Light (SlrW)", y = "Daily Growth (cm/day)") +
theme_bw()
#Standardization
plant_with_light$weekly_avg_SlrW2 <- scale(plant_with_light$weekly_avg_SlrW, center = TRUE, scale = TRUE)
mean_light <- mean(plant_with_light$weekly_avg_SlrW, na.rm = TRUE)
sd_light   <- sd(plant_with_light$weekly_avg_SlrW, na.rm = TRUE)
#Change Data type
plant_with_light <- plant_with_light %>%
mutate(
parent_pop = factor(parent_pop),
PID        = factor(PID),
block      = factor(block)
)
growth_light.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 +
(1 + weekly_avg_SlrW2 | parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light.lmer)
#Unscaling
pred_all <- ggpredict(growth_light.lmer, terms = "weekly_avg_SlrW2") %>%
as.data.frame() %>%
mutate(light_orig = x * sd_light + mean_light)
#Plot
p_overall <- ggplot() +
geom_hex(data = plant_with_light,
aes(x = weekly_avg_SlrW, y = daily_growth), bins = 35) +
scale_fill_viridis_c(name = "Count") +
geom_ribbon(data = pred_all,
aes(x = light_orig, ymin = conf.low, ymax = conf.high),
alpha = .22, fill = "grey60") +
geom_line(data = pred_all,
aes(x = light_orig, y = predicted), linewidth = 1) +
labs(title = "Figure C: Effect of Weekly Light on Daily Growth (overall)",
x = "Weekly Avg Light (W/m²)",
y = "Predicted Daily Growth (cm/day)") +
theme_bw() +
theme(panel.grid.minor = element_blank())
p_overall
p_facet <- ggplot(plant_with_light,
aes(weekly_avg_SlrW, daily_growth)) +
facet_wrap(~ parent_pop, ncol = 6) +
geom_point(alpha = .15, size = .6, color = "grey35") +
geom_smooth(method = "lm", se = FALSE, linewidth = .8) +
labs(title = "Figure D: Light–Growth relationship by population",
x = "Weekly Avg Light (W/m²)",
y = "Daily Growth (cm/day)") +
theme_bw() +
theme(strip.background = element_rect(fill = "grey95", color = NA),
strip.text = element_text(face = "bold"),
panel.grid.minor = element_blank())
p_facet
#slope and standard deviation of fixed effects
b_fix  <- fixef(growth_light.lmer)["weekly_avg_SlrW2"]
V_fix  <- vcov(growth_light.lmer)["weekly_avg_SlrW2","weekly_avg_SlrW2"]
#slope and standard deviation of random effects
re <- ranef(growth_light.lmer, condVar = TRUE)
re_pop <- re$parent_pop
postVar <- attr(re$parent_pop, "postVar")
sl_col <- which(colnames(re_pop) == "weekly_avg_SlrW2")
#create the tibble of slopes for each population
pop_slope <- tibble(
parent_pop   = rownames(re_pop),
rand_slope   = re_pop[ , "weekly_avg_SlrW2"],
rand_var     = sapply(seq_len(dim(postVar)[3]), function(i) postVar[sl_col, sl_col, i])
) %>%
mutate(
slope_SD   = b_fix + rand_slope,
se_SD      = sqrt(V_fix + rand_var),
lower_SD   = slope_SD - 1.96*se_SD,
upper_SD   = slope_SD + 1.96*se_SD
)
sd_light <- sd(plant_with_light$weekly_avg_SlrW, na.rm = TRUE)
pop_slope <- pop_slope %>%
mutate(
slope_per_Wm2 = slope_SD / sd_light,
lower_per_Wm2 = lower_SD / sd_light,
upper_per_Wm2 = upper_SD / sd_light
)%>%
select(parent_pop, slope_per_Wm2, lower_per_Wm2, upper_per_Wm2)
pop_slope
write.csv(pop_slope, "population_slopes.csv", row.names = FALSE)
#plot
ggplot(pop_slope, aes(x = reorder(parent_pop, slope_per_Wm2), y = slope_per_Wm2)) +
geom_hline(yintercept = 0, linetype = 2) +
geom_pointrange(aes(ymin = lower_per_Wm2, ymax = upper_per_Wm2), linewidth = .6) +
coord_flip() +
labs(title = "Figure E: Population-specific slopes with 95% CI",
x = "Population", y = "Slope (cm/day per W/m²)") +
theme_bw()
light_daily <- light_raw %>%
mutate(date = as.Date(TIMESTAMP)) %>%
group_by(date) %>%
summarise(SlrW_mean = mean(SlrW_Avg, na.rm = TRUE), .groups = "drop")
df_plot <- plant_with_light %>%
filter(!is.na(survey_date), !is.na(height_cm), !is.na(weekly_avg_SlrW))
y_rng     <- range(df_plot$height_cm, na.rm = TRUE)
light_rng <- range(light_daily$SlrW_mean, na.rm = TRUE)
light_daily <- light_daily %>%
mutate(light_y = scales::rescale(SlrW_mean, to = y_rng, from = light_rng))
plant_with_light%>%
group_by(parent_pop)%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW)) +
#  geom_line(data = light_daily,
#            aes(x = date, y = light_y),
#            colour = "black", linewidth = 0.5, alpha= 0.25) +
facet_wrap(~parent_pop)+
scale_colour_gradientn(                         # 低=蓝，高=红
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=1, size=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
#    sec.axis = sec_axis(~ scales::rescale(., from = y_rng, to = light_rng),
#                        name = "Solar Radiation (W/m²)"))+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
#  group_by(parent_pop)%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
#  geom_line(data = light_daily,
#            aes(x = date, y = light_y),
#            colour = "black", linewidth = 0.5, alpha= 0.25) +
facet_wrap(~parent_pop)+
scale_colour_gradientn(                         # 低=蓝，高=红
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=1, size=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
#    sec.axis = sec_axis(~ scales::rescale(., from = y_rng, to = light_rng),
#                        name = "Solar Radiation (W/m²)"))+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
#  group_by(parent_pop)%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
#  geom_line(data = light_daily,
#            aes(x = date, y = light_y),
#            colour = "black", linewidth = 0.5, alpha= 0.25) +
facet_wrap(~parent_pop)+
scale_colour_gradientn(                         # 低=蓝，高=红
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
#    sec.axis = sec_axis(~ scales::rescale(., from = y_rng, to = light_rng),
#                        name = "Solar Radiation (W/m²)"))+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
knitr::opts_chunk$set(echo = TRUE)
plant_with_light%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
facet_wrap(~parent_pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
#install.packages("emmeans")
library(emmeans)
#install.packages("broom.mixed")
library(broom.mixed)
library(viridis)
library(nlme)
library(mgcv)
#setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
plant_with_light%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
facet_wrap(~parent_pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
select(parent_pop="TM2")
plant_with_light%>%
select(parent_pop=="TM2")
plant_with_light%>%
filter(parent_pop=="TM2")
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
filter(parent_pop=="TM2")%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
filter(parent_pop=="TM2")%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
filter(parent_pop=="TM2")%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
filter(parent_pop=="CP3")%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
plant_with_light%>%
filter(parent_pop=="FR")%>%
ggplot(aes(survey_date, height_cm, colour = weekly_avg_SlrW, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
View(pl_lt)
knitr::opts_chunk$set(echo = TRUE)
#tinytex::tlmgr_install("ctex")
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
guides(x = guide_axis(n.dodge = 2))
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
theme(axis.text.x = element_text(angle=45))
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
guides(x = guide_axis(n.dodge = 2))+
theme(axis.text.x = element_text(angle=45))+
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
#  guides(x = guide_axis(n.dodge = 2))+
theme(axis.text.x = element_text(angle=30))+
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
#  guides(x = guide_axis(n.dodge = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle=30))
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "solar radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
guides(x = guide_axis(n.dodge = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle=30))
pl_lt%>%
filter(pop=="TM2")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=pop)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.2: Time-Height for TM2",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
facet_wrap(~pop)+
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=0.25,size=0.5)+
geom_line(alpha=0.5) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.1: Time-Height",
x = "Survey Date",
y = "Height (cm)") +
guides(x = guide_axis(n.dodge = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle=30))
pl_lt%>%
filter(pop=="TM2")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.2: Time-Height for TM2",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
filter(pop=="BH")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.3: Time-Height for BH",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
filter(pop=="DPR")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.4: Time-Height for DPR",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
#tinytex::tlmgr_install("ctex")
tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
system2(tinytex::tlmgr_path(), args = c("fmtutil-sys", "--all"))
#tinytex::tlmgr_install("ctex")
#tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
#tinytex::tlmgr_update(all  = TRUE)     # 更新所有 LaTeX 包
tinytex::tlmgr_install(c("latex-bin", "l3kernel", "l3packages", "l3backend"))
