y = "Height (cm)") +
guides(x = guide_axis(n.dodge = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle=30))
pl_lt%>%
filter(pop=="TM2")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.2: Time-Height for TM2",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
filter(pop=="BH")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.3: Time-Height for BH",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
pl_lt%>%
filter(pop=="DPR")%>%
ggplot(aes(survey_date, height, colour = mean_light_ly_day, group=PID)) +
scale_colour_gradientn(                         # low=blue, high=red
colours = c("#2c7bb6","#abd9e9","#ffffbf","#fdae61","#d7191c"),
name = "Solar Radiation (W/m²)")+
geom_point(alpha=1,size=0.5)+
geom_line(alpha=1) +
scale_x_date(date_breaks = "1 month", date_labels = "%b") +
scale_y_continuous(
name = "Height (cm)")+
labs(title = "Figure F.4: Time-Height for DPR",
x = "Survey Date",
y = "Height (cm)") +
theme_bw()
#tinytex::tlmgr_install("ctex")
tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
system2(tinytex::tlmgr_path(), args = c("fmtutil-sys", "--all"))
#tinytex::tlmgr_install("ctex")
#tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
#tinytex::tlmgr_update(all  = TRUE)     # 更新所有 LaTeX 包
tinytex::tlmgr_install(c("latex-bin", "l3kernel", "l3packages", "l3backend"))
knitr::opts_chunk$set(echo = TRUE)
#tinytex::tlmgr_install("ctex")
#tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
#tinytex::tlmgr_update(all  = TRUE)     # 更新所有 LaTeX 包
#tinytex::tlmgr_install(c("latex-bin", "l3kernel", "l3packages", "l3backend"))
#system2(tinytex::tlmgr_path(), args = c("fmtutil-sys", "--all"))
write.csv(pl_lt, "Data/pl_lt", row.names=FALSE)
knitr::opts_chunk$set(echo = TRUE)
pl_lt <- read.csv("Data/pl_lt.csv")
pl_lt <- read.csv("Data/pl_lt.csv")
View(pl_lt)
View(pl_lt)
pl_lt <- read.csv("Data/pl_lt.csv")
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week_index = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
library(dplyr)
library(lubridate)
pl_lt <- read.csv("Data/pl_lt.csv")
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week_index = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week_index = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
View(pl_lt)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week + (1 + mean_light_ly_day2 + week | pop),
data = pl_lt, REML = TRUE
)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week + (1 + mean_light_ly_day2 + week | pop),
data = pl_lt, REML = TRUE
)
summary(pl_lt_t.lmer)
knitr::opts_chunk$set(echo = TRUE)
#Standardization
plant_with_light$weekly_avg_SlrW2 <- scale(plant_with_light$weekly_avg_SlrW, center = TRUE, scale = TRUE)
mean_light <- mean(plant_with_light$weekly_avg_SlrW, na.rm = TRUE)
sd_light   <- sd(plant_with_light$weekly_avg_SlrW, na.rm = TRUE)
#Change Data type
plant_with_light <- plant_with_light %>%
mutate(
parent_pop = factor(parent_pop),
PID        = factor(PID),
block      = factor(block)
)
write.csv(plant_with_light, "Data/plant_with_light", row.names=FALSE)
pl_lt <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
View(plant_with_light)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + week
(1 + weekly_avg_SlrW2 + week | parent_pop),
data = plant_with_light, REML = TRUE
)
View(plant_with_light)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + week + (1 + weekly_avg_SlrW2 + week | parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light_time.lmer)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + week + (1 + weekly_avg_SlrW2 + week | parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light_time.lmer)
p_facet <- ggplot(pl_lt,
aes(mean_light_ly_day, daily_growth)) +
facet_wrap(~ pop, ncol = 6) +
geom_point(alpha = .15, size = .6, color = "grey35") +
geom_smooth(method = "lm", se = FALSE, linewidth = .8) +
labs(title = "Figure D: Light–Growth relationship by population",
x = "Daily Avg Light (ly/day)",
y = "Daily Growth (cm/day)") +
theme_bw() +
theme(strip.background = element_rect(fill = "grey95", color = NA),
strip.text = element_text(face = "bold"),
panel.grid.minor = element_blank())
p_facet
View(plant_growth_daily)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week + (1 + mean_light_ly_day2 + week | pop),
data = pl_lt, REML = TRUE
)
summary  (pl_lt_t.lmer)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + week + (1 + weekly_avg_SlrW2 + week | parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light_time.lmer)
knitr::opts_chunk$set(echo = TRUE)
pl_lt$week_f <- as.factor(pl_lt$week)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt$week_f <- as.factor(pl_lt$week)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week_f + (1 + mean_light_ly_day2 + week_f | pop),
data = pl_lt, REML = TRUE
)
summary  (pl_lt_t.lmer)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt$week_f <- as.factor(pl_lt$week)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week_f + (1 + mean_light_ly_day2 + | pop),
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt$week_f <- as.factor(pl_lt$week)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + week_f + (1 + mean_light_ly_day2 | pop),
data = pl_lt, REML = TRUE
)
summary  (pl_lt_t.lmer)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
plant_with_light$week_f <- as.factor(plant_with_light$week)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + week_f+ (1 + weekly_avg_SlrW2 | parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light_time.lmer)
knitr::opts_chunk$set(echo = TRUE)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
pl_lt <- read.csv("Data/pl_lt.csv")%>% mutate(survey_date = as.Date(survey_date))
pl_lt <- pl_lt %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
pl_lt$week_f <- as.factor(pl_lt$week)
pl_lt_t.lmer <- lmer(
daily_growth ~ mean_light_ly_day2 + (1 + mean_light_ly_day2 | pop) + (week|pop),
data = pl_lt, REML = TRUE
)
summary  (pl_lt_t.lmer)
plant_with_light <- read.csv("Data/plant_with_light.csv")%>% mutate(survey_date = as.Date(survey_date))
plant_with_light <- plant_with_light %>%
arrange(survey_date) %>%
mutate(
week = as.integer((as.numeric(survey_date - min(survey_date)) %/% 7) + 1)
)
plant_with_light$week_f <- as.factor(plant_with_light$week)
growth_light_time.lmer <- lmer(
daily_growth ~ weekly_avg_SlrW2 + (1 + weekly_avg_SlrW2 | parent_pop) + (week|parent_pop),
data = plant_with_light, REML = TRUE
)
summary(growth_light_time.lmer)
knitr::opts_chunk$set(echo = TRUE)
#tinytex::tlmgr_install("ctex")
#tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
#tinytex::tlmgr_update(all  = TRUE)     # 更新所有 LaTeX 包
#tinytex::tlmgr_install(c("latex-bin", "l3kernel", "l3packages", "l3backend"))
#system2(tinytex::tlmgr_path(), args = c("fmtutil-sys", "--all"))
lmer(relative_growth ~ weekly_avg_SlrW * parent_pop + (1|PID), data = combined_data)
knitr::opts_chunk$set(echo = TRUE)
#tinytex::tlmgr_install("ctex")
#tinytex::tlmgr_update(self = TRUE)     # 更新 tlmgr 本身
#tinytex::tlmgr_update(all  = TRUE)     # 更新所有 LaTeX 包
#tinytex::tlmgr_install(c("latex-bin", "l3kernel", "l3packages", "l3backend"))
#system2(tinytex::tlmgr_path(), args = c("fmtutil-sys", "--all"))
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
library(readr)
library(ggthemes)
library(ggeffects)
library(lme4)
library(dplyr)
library(ggplot2)
library(emmeans)
library(broom.mixed)
library(viridis)
library(nlme)
library(mgcv)
setwd("C:/Users/Tobyz/Desktop/Toby在大学/Maloof Lab/S.tort-light-growth/Data")
lmer(relative_growth ~ weekly_avg_SlrW * parent_pop + (1|PID), data = combined_data)
lmer(relative_growth ~ weekly_avg_SlrW * parent_pop + (1|PID), data = pl_lt)
View(pl_lt)
View(plant_growth)
knitr::opts_chunk$set(echo = TRUE)
dim(Y); dim(X)
#install.packages("pkgbuild")
#pkgbuild::check_build_tools(debug = TRUE)
#install.packages(c("Rcpp", "RcppEigen", "cli", "rlang", "vctrs", "pillar", "lifecycle"))
#install.packages(c("devtools","remotes"))
#remotes::install_github("bcm-uga/lfmm",
#                        dependencies = TRUE,
#                        build_vignettes = FALSE,
#                        force = TRUE)
#install.packages("RSpectra")
library(lme4)
library(tibble)
library(dplyr)
library(tidyverse)
library(lfmm)
library(RSpectra)
load("pl_lt_t.lmer.RData")
load("growth_light_time.lmer.RData")
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(.name_repair = "unique") %>%
rownames_to_column("pop") %>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `mean_light_ly_day2`) %>%
mutate(model = "Y2022")
pheno_2023 <- ranef(growth_light_time.lmer)$parent_pop %>%
as_tibble(.name_repair = "unique") %>%
rownames_to_column("parent_pop") %>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `weekly_avg_SlrW2`) %>%
mutate(model = "Y2023")
geno_22 <- read.delim("Data/merged_maf_common_UCD2022.tsv", header = TRUE)
geno_23 <- read.delim("Data/merged_maf_common_WL2_2023.tsv", header = TRUE)
Y <- as.matrix(geno_22[,-1])
pc <- prcomp(Y)
plot(pc$sdev[1:20]^2, xlab = 'PC', ylab = "Variance explained")
points(2,pc$sdev[2]^2, type = "h", lwd = 3, col = "blue")
Y <- as.matrix(geno_22[,-1])
Y <- t(Y)
X <- matrix(scale(pheno_2022$blup_light), ncol = 1)
rownames(X) <- pheno_2022$pop
colnames(X) <- "blup_light"
common <- intersect(rownames(X), rownames(Y))
X <- X[common, , drop = FALSE]
dim(Y); dim(X)
object.size(Y)
dim(Y); dim(X)
object.size(Y)
View(X)
View(Y)
View(Y)
X <- matrix(scale(pheno_2022$blup_light), ncol = 1)
View(X)
colnames(X) <- "blup_light"
common <- intersect(rownames(X), rownames(Y))
rownames(X) <- pheno_2022$pop
View(pheno_2022)
View(pheno_2023)
View(pheno_2023)
View(pl_lt_t.lmer)
View(pl_lt_t.lmer)
ranef(pl_lt_t.lmer)
View(pl_lt_t.lmer)
View(pheno_2022)
ranef(pl_lt_t.lmer)
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(rownames = "pop", .name_repair = "unique") %>%
rownames_to_column("pop") %>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `mean_light_ly_day2`) %>%
mutate(model = "Y2022")
ranef(pl_lt_t.lmer)$pop
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(.name_repair = "unique")
View(pheno_2022)
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(.name_repair = "unique")%>%
rownames_to_column("pop")
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(rownames = "pop",.name_repair = "unique")
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(rownames = "pop",.name_repair = "unique")%>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `mean_light_ly_day2`) %>%
mutate(model = "Y2022")
X <- matrix(scale(pheno_2022$blup_light), ncol = 1)
rownames(X) <- pheno_2022$pop
colnames(X) <- "blup_light"
common <- intersect(rownames(X), rownames(Y))
X <- X[common, , drop = FALSE]
dim(Y); dim(X)
mod.lfmm <- lfmm_ridge(Y = Y,
X = X,
K = 2)
knitr::opts_chunk$set(echo = TRUE)
#install.packages("pkgbuild")
#pkgbuild::check_build_tools(debug = TRUE)
#install.packages(c("Rcpp", "RcppEigen", "cli", "rlang", "vctrs", "pillar", "lifecycle"))
#install.packages(c("devtools","remotes"))
#remotes::install_github("bcm-uga/lfmm",
#                        dependencies = TRUE,
#                        build_vignettes = FALSE,
#                        force = TRUE)
#install.packages("RSpectra")
library(lme4)
library(tibble)
library(dplyr)
library(tidyverse)
library(lfmm)
library(RSpectra)
load("pl_lt_t.lmer.RData")
load("growth_light_time.lmer.RData")
ranef(pl_lt_t.lmer)$pop
pheno_2022 <- ranef(pl_lt_t.lmer)$pop %>%
as_tibble(rownames = "pop",.name_repair = "unique")%>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `mean_light_ly_day2`) %>%
mutate(model = "Y2022")
pheno_2023 <- ranef(growth_light_time.lmer)$parent_pop %>%
as_tibble(rownames = "parent_pop", .name_repair = "unique") %>%
rename(blup_intercept = `(Intercept)...1`,
blup_light = `weekly_avg_SlrW2`) %>%
mutate(model = "Y2023")
geno_22 <- read.delim("Data/merged_maf_common_UCD2022.tsv", header = TRUE)
geno_23 <- read.delim("Data/merged_maf_common_WL2_2023.tsv", header = TRUE)
Y <- as.matrix(geno_22[,-1])
pc <- prcomp(Y)
plot(pc$sdev[1:20]^2, xlab = 'PC', ylab = "Variance explained")
points(2,pc$sdev[2]^2, type = "h", lwd = 3, col = "blue")
Y <- as.matrix(geno_22[,-1])
Y <- t(Y)
X <- matrix(scale(pheno_2022$blup_light), ncol = 1)
rownames(X) <- pheno_2022$pop
colnames(X) <- "blup_light"
common <- intersect(rownames(X), rownames(Y))
X <- X[common, , drop = FALSE]
mod.lfmm <- lfmm_ridge(Y = Y,
X = X,
K = 2)
## performs association testing using the fitted model:
pv <- lfmm_test(Y = Y,
X = X,
lfmm = mod.lfmm,
calibrate = "gif")
pvalues <- pv$calibrated.pvalue
#QQ plot
qqplot(rexp(length(pvalues), rate = log(10)),
-log10(pvalues), xlab = "Expected quantile",
pch = 19, cex = .4)
abline(0,1)
## Manhattan plot
plot(-log10(pvalues),
pch = 19,
cex = .2,
xlab = "SNP", ylab = "-Log P",
col = "grey")
