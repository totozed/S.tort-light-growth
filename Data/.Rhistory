files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# æå–æ—¥æœŸï¼ˆç¬¬ä¸€åˆ—åˆ—åï¼‰ï¼Œé‡å‘½åä¸º date_col
date_str <- names(df)[1]
df <- df %>% rename(date_col = !!date_str)
# æ·»åŠ æ—¥æœŸ + plant_id + è½¬æ¢ç°æœ‰åˆ—
df <- df %>%
mutate(
date = mdy(date_str),
bed.row = as.numeric(bed.row),
height.cm = as.numeric(height.cm),
source_file = f,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_")
)
# å¦‚æœå­˜åœ¨ long.leaf.cm å°±è½¬æ¢
if ("long.leaf.cm" %in% names(df)) {
df <- df %>% mutate(long.leaf.cm = as.numeric(long.leaf.cm))
}
return(df)
}
)
library(tidyverse)
library(readxl)
library(lubridate)
setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# æå–æ—¥æœŸï¼ˆç¬¬ä¸€åˆ—åˆ—åï¼‰ï¼Œé‡å‘½åä¸º date_col
date_str <- names(df)[1]
df <- df %>% rename(date_col = !!date_str)
# æ·»åŠ æ—¥æœŸ + plant_id + è½¬æ¢ç°æœ‰åˆ—
df <- df %>%
mutate(
date = mdy(date_str),
bed.row = as.numeric(bed.row),
height.cm = as.numeric(height.cm),
source_file = f,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_")
)
# å¦‚æœå­˜åœ¨ long.leaf.cm å°±è½¬æ¢
if ("long.leaf.cm" %in% names(df)) {
df <- df %>% mutate(long.leaf.cm = as.numeric(long.leaf.cm))
}
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# æå–æ—¥æœŸï¼ˆç¬¬ä¸€åˆ—åˆ—åï¼‰ï¼Œé‡å‘½åä¸º date_col
date_str <- names(df)[1]
df <- df %>% rename(date_col = !!date_str)
# æ·»åŠ æ—¥æœŸ + plant_id + è½¬æ¢ç°æœ‰åˆ—
df <- df %>%
mutate(
date = mdy(date_str),
bed.row = as.numeric(bed.row),
height.cm = as.numeric(height.cm),
source_file = f,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_")
)
# å¦‚æœå­˜åœ¨ long.leaf.cm å°±è½¬æ¢
if ("long.leaf.cm" %in% names(df)) {
df <- df %>% mutate(long.leaf.cm = as.numeric(long.leaf.cm))
}
return(df)
}
)
library(tidyverse)
library(readxl)
library(lubridate)
setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# æå–æ—¥æœŸï¼ˆç¬¬ä¸€åˆ—åˆ—åï¼‰ï¼Œé‡å‘½åä¸º date_col
date_str <- names(df)[1]
df <- df %>% rename(date_col = !!date_str)
# æ·»åŠ æ—¥æœŸ + plant_id + è½¬æ¢ç°æœ‰åˆ—
df <- df %>%
mutate(
date = mdy(date_str),
bed.row = as.numeric(bed.row),
height.cm = as.numeric(height.cm),
source_file = f,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_")
)
# å¦‚æœå­˜åœ¨ long.leaf.cm å°±è½¬æ¢
if ("long.leaf.cm" %in% names(df)) {
df <- df %>% mutate(long.leaf.cm = as.numeric(long.leaf.cm))
}
return(df)
}
)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# å¦‚æœæ²¡æœ‰ bed.rowï¼Œç›´æ¥è·³è¿‡è¿™ä¸ªæ–‡ä»¶
if (!"bed.row" %in% names(df)) {
cat("âš ï¸ è·³è¿‡ç¼ºåˆ—æ–‡ä»¶:", f, "\n")
return(tibble())  # è¿”å›ç©º tibble
}
df <- df %>%
mutate(
date = mdy(date),
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# å¦‚æœæ²¡æœ‰ bed.rowï¼Œç›´æ¥è·³è¿‡è¿™ä¸ªæ–‡ä»¶
if (!"bed.row" %in% names(df)) {
cat("âš ï¸ è·³è¿‡ç¼ºåˆ—æ–‡ä»¶:", f, "\n")
return(tibble())  # è¿”å›ç©º tibble
}
df <- df %>%
mutate(
date = mdy(.data$date),
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
unique(size_data$date_raw)
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# å¦‚æœæ²¡æœ‰ bed.rowï¼Œç›´æ¥è·³è¿‡è¿™ä¸ªæ–‡ä»¶
if (!"bed.row" %in% names(df)) {
cat("âš ï¸ è·³è¿‡ç¼ºåˆ—æ–‡ä»¶:", f, "\n")
return(tibble())  # è¿”å›ç©º tibble
}
df <- df %>%
mutate(
date = mdy(.data$Date),
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(Date),  # ğŸ” å¦‚æœä¸ç¡®å®šé¦–å­—æ¯ï¼Œæ”¹æˆ mdy(.data[["Date"]])
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")%>%clean_names()
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")%>%clean_names()
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(Date),  # ğŸ” å¦‚æœä¸ç¡®å®šé¦–å­—æ¯ï¼Œæ”¹æˆ mdy(.data[["Date"]])
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(date)  # ğŸ” å¦‚æœä¸ç¡®å®šé¦–å­—æ¯ï¼Œæ”¹æˆ mdy(.data[["Date"]])
bed.row = as.numeric(bed.row),
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(date),  # ğŸ” å¦‚æœä¸ç¡®å®šé¦–å­—æ¯ï¼Œæ”¹æˆ mdy(.data[["Date"]])
bed.row = as.numeric(bed.row),
bed.col = as.character(bed.col),
height.cm = as.numeric(height.cm),
long.leaf.cm = if ("long.leaf.cm" %in% names(.)) as.numeric(long.leaf.cm) else NA,
plant_id = paste(block, bed, bed.row, bed.col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(date),  # é¦–å­—æ¯å°å†™
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(long_leaf_cm) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
size_data <- map_dfr(
files,
function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE)%>%clean_names()
# ç»Ÿä¸€å¤„ç†æ ¼å¼ï¼Œç¡®ä¿è½¬å‹å®‰å…¨
df <- df %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
}
)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names()
df <- df %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names()
df <- df %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
# å°è¯•è¯»å–æ¯ä¸ªæ–‡ä»¶
results <- map(files, safe_read_process)
# æ‹†å‡ºæˆåŠŸå’Œå¤±è´¥é¡¹
successful_data <- map_dfr(results, "result")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
janitor::clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
# âœ… æˆåŠŸçš„æ‰åˆå¹¶
successful_data <- map_dfr(results, "result")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
# âœ… æˆåŠŸé¡¹æå–ï¼Œè‡ªåŠ¨å¸¦ä¸Š source_index
successful_data <- map_dfr(results, "result", .id = "source_index")
knitr::opts_chunk$set(echo = TRUE)
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
# âœ… æˆåŠŸé¡¹æå–ï¼Œè‡ªåŠ¨å¸¦ä¸Š source_index
successful_data <- map_dfr(results, "result", .id = "source_index")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
rm(list = ls())
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
successful_data <- map_dfr(results, "result", .id = "source_index")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
library(purrr)
setwd("C:/Users/Tobyz/Desktop/S.tort-light-growth/Data")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
successful_data <- map_dfr(results, "result", .id = "source_index")
results <- map(files, safe_read_process)
successful_results <- keep(results, ~ !is.null(.x$result))
successful_data <- bind_rows(map(successful_results, "result"), .id = "source_index")
files <- list.files(pattern = "WL2_size_survey.*\\.csv$")
safe_read_process <- safely(function(f) {
df <- read_csv(f, col_names = TRUE, show_col_types = FALSE) %>%
clean_names() %>%
mutate(
date = mdy(date),
bed_row = as.numeric(bed_row),
bed_col = as.character(bed_col),
height_cm = as.numeric(height_cm),
long_leaf_cm = if ("long_leaf_cm" %in% names(.)) as.numeric(as.character(long_leaf_cm)) else NA,
plant_id = paste(block, bed, bed_row, bed_col, sep = "_"),
source_file = f
)
return(df)
})
results <- map(files, safe_read_process)
successful_results <- keep(results, ~ !is.null(.x$result))
successful_data <- bind_rows(map(successful_results, "result"), .id = "source_index")
light_raw <- read_csv("CR1000XSeries_IntBioHalfHourTable.txt", skip = 1, show_col_types = FALSE)
# å¤„ç†
weekly_light <- light_raw %>%
mutate(
timestamp = ymd_hms(TIMESTAMP),
week = floor_date(timestamp, "week")
) %>%
group_by(week) %>%
summarise(
weekly_avg_SlrW = mean(SlrW_Avg, na.rm = TRUE),
.groups = "drop"
)
# æŸ¥çœ‹ç»“æœ
print(weekly_light)
light_raw <- read_csv("CR1000XSeries_IntBioHalfHourTable.txt", skip = 1, show_col_types = FALSE)
weekly_light <- light_raw %>%
mutate(
timestamp = ymd_hms(TIMESTAMP),
SlrW_Avg = as.numeric(SlrW_Avg),  # ğŸ’¡ å¼ºåˆ¶è½¬æˆæ•°å€¼å‹
week = floor_date(timestamp, "week")
) %>%
group_by(week) %>%
summarise(
weekly_avg_SlrW = mean(SlrW_Avg, na.rm = TRUE),
.groups = "drop"
)
# æŸ¥çœ‹ç»“æœ
print(weekly_light)
