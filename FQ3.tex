% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\documentclass[
]{article}
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={FQ3},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{FQ3}
\author{}
\date{\vspace{-2.5em}2025-11-20}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("ISOweek")}
\FunctionTok{library}\NormalTok{(ISOweek)}
\FunctionTok{library}\NormalTok{(lme4) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'lubridate'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(janitor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'janitor'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     chisq.test, fisher.test
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tibble)}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v forcats 1.0.0     v stringr 1.5.1
## v ggplot2 3.5.2     v tidyr   1.3.1
## v purrr   1.0.4
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x tidyr::expand() masks Matrix::expand()
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## x tidyr::pack()   masks Matrix::pack()
## x tidyr::unpack() masks Matrix::unpack()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggthemes)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(lfmm)}
\FunctionTok{library}\NormalTok{(RSpectra)}
\CommentTok{\#install.packages("fuzzyjoin")}
\FunctionTok{library}\NormalTok{(fuzzyjoin)}
\FunctionTok{load}\NormalTok{(}\StringTok{"pl\_lt\_t.lmer.RData"}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\StringTok{"growth\_light\_time.lmer.RData"}\NormalTok{)}
\FunctionTok{source}\NormalTok{(}\StringTok{"manhattan\_plot.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'scales'
## 
## The following object is masked from 'package:purrr':
## 
##     discard
## 
## The following object is masked from 'package:readr':
## 
##     col_factor
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#file\_path \textless{}{-} file.choose()}
\CommentTok{\#rmarkdown::render(file\_path)}
\end{Highlighting}
\end{Shaded}

manhattan plot for 2022

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pheno\_22 }\OtherTok{\textless{}{-}} \FunctionTok{ranef}\NormalTok{(pl\_lt\_t.lmer)}\SpecialCharTok{$}\NormalTok{pop }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_tibble}\NormalTok{(}\AttributeTok{rownames =} \StringTok{"pop"}\NormalTok{,}\AttributeTok{.name\_repair =} \StringTok{"unique"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{blup\_intercept =} \StringTok{\textasciigrave{}}\AttributeTok{(Intercept)...1}\StringTok{\textasciigrave{}}\NormalTok{,}
         \AttributeTok{blup\_light =} \StringTok{\textasciigrave{}}\AttributeTok{mean\_light\_ly\_day2}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{model =} \StringTok{"Y2022"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## New names:
## * `(Intercept)` -> `(Intercept)...1`
## * `(Intercept)` -> `(Intercept)...3`
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{geno\_22 }\OtherTok{\textless{}{-}} \FunctionTok{read.delim}\NormalTok{(}\StringTok{"Data/merged\_maf\_common\_UCD2022.tsv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{Y }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(geno\_22[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])}
\NormalTok{Y }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(Y)}
\NormalTok{X }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{scale}\NormalTok{(pheno\_22}\SpecialCharTok{$}\NormalTok{blup\_light), }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(X) }\OtherTok{\textless{}{-}}\NormalTok{ pheno\_22}\SpecialCharTok{$}\NormalTok{pop}
\FunctionTok{colnames}\NormalTok{(X) }\OtherTok{\textless{}{-}} \StringTok{"blup\_light"}
\NormalTok{common }\OtherTok{\textless{}{-}} \FunctionTok{intersect}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(X), }\FunctionTok{rownames}\NormalTok{(Y))}
\NormalTok{Y }\OtherTok{\textless{}{-}}\NormalTok{ Y[common,]}
\NormalTok{X }\OtherTok{\textless{}{-}}\NormalTok{ X[common, , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{mod.lfmm }\OtherTok{\textless{}{-}} \FunctionTok{lfmm\_ridge}\NormalTok{(}\AttributeTok{Y =}\NormalTok{ Y, }
                        \AttributeTok{X =}\NormalTok{ X, }
                        \AttributeTok{K =} \DecValTok{2}\NormalTok{)}

\NormalTok{ pv }\OtherTok{\textless{}{-}} \FunctionTok{lfmm\_test}\NormalTok{(}\AttributeTok{Y =}\NormalTok{ Y, }
                 \AttributeTok{X =}\NormalTok{ X, }
                 \AttributeTok{lfmm =}\NormalTok{ mod.lfmm, }
                 \AttributeTok{calibrate =} \StringTok{"gif"}\NormalTok{)}
\NormalTok{pvalues }\OtherTok{\textless{}{-}}\NormalTok{ pv}\SpecialCharTok{$}\NormalTok{calibrated.pvalue}

\NormalTok{plot\_data }\OtherTok{=} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{loci =}\NormalTok{ geno\_22[,}\DecValTok{1}\NormalTok{], }\AttributeTok{p\_val =}\NormalTok{ pv}\SpecialCharTok{$}\NormalTok{pvalue[,}\DecValTok{1}\NormalTok{], }\AttributeTok{calibrated.pvalue =}\NormalTok{ pv}\SpecialCharTok{$}\NormalTok{calibrated.pvalue[,}\DecValTok{1}\NormalTok{]) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{separate\_wider\_delim}\NormalTok{(loci, }\AttributeTok{delim =} \StringTok{":"}\NormalTok{, }\AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"chr"}\NormalTok{, }\StringTok{"bp"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(chr, }\StringTok{"Chr"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{mutate}\NormalTok{(}\AttributeTok{p.bonf =} \FunctionTok{p.adjust}\NormalTok{(p\_val, }\AttributeTok{method =} \StringTok{"bonferroni"}\NormalTok{),}
\AttributeTok{bp =} \FunctionTok{as.numeric}\NormalTok{(bp))}


\NormalTok{manhattan\_22 }\OtherTok{=} \FunctionTok{plot\_manhattan}\NormalTok{(plot\_data,}
                        \AttributeTok{chr\_col =} \StringTok{"chr"}\NormalTok{,}
                        \AttributeTok{pos\_col =} \StringTok{"bp"}\NormalTok{,}
                        \AttributeTok{value\_col =} \StringTok{"calibrated.pvalue"}\NormalTok{,}
                        \AttributeTok{transform =} \StringTok{"neglog10"}\NormalTok{,}
                        \AttributeTok{title =} \StringTok{"Light association"}\NormalTok{,}
                        \AttributeTok{highlight\_top\_n =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

manhattan plot for WL2 2023

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#import the X and Y}
\NormalTok{pheno\_23 }\OtherTok{\textless{}{-}} \FunctionTok{ranef}\NormalTok{(growth\_light\_time.lmer)}\SpecialCharTok{$}\NormalTok{parent\_pop }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_tibble}\NormalTok{(}\AttributeTok{rownames =} \StringTok{"parent\_pop"}\NormalTok{, }\AttributeTok{.name\_repair =} \StringTok{"unique"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{blup\_intercept =} \StringTok{\textasciigrave{}}\AttributeTok{(Intercept)...1}\StringTok{\textasciigrave{}}\NormalTok{,}
         \AttributeTok{blup\_light =} \StringTok{\textasciigrave{}}\AttributeTok{weekly\_avg\_SlrW2}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{model =} \StringTok{"Y2023"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## New names:
## * `(Intercept)` -> `(Intercept)...1`
## * `(Intercept)` -> `(Intercept)...3`
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{geno\_23 }\OtherTok{\textless{}{-}} \FunctionTok{read.delim}\NormalTok{(}\StringTok{"Data/merged\_maf\_common\_WL2\_2023.tsv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\#process the data}
\NormalTok{Y\_23 }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(geno\_23[,}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])}
\NormalTok{Y\_23 }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(Y\_23)}
\NormalTok{X\_23 }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{scale}\NormalTok{(pheno\_23}\SpecialCharTok{$}\NormalTok{blup\_light), }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(X\_23) }\OtherTok{\textless{}{-}}\NormalTok{ pheno\_23}\SpecialCharTok{$}\NormalTok{parent\_pop}
\FunctionTok{colnames}\NormalTok{(X\_23) }\OtherTok{\textless{}{-}} \StringTok{"blup\_light"}
\NormalTok{common }\OtherTok{\textless{}{-}} \FunctionTok{intersect}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(X\_23), }\FunctionTok{rownames}\NormalTok{(Y\_23))}
\NormalTok{Y\_23 }\OtherTok{\textless{}{-}}\NormalTok{ Y\_23[common,]}
\NormalTok{X\_23 }\OtherTok{\textless{}{-}}\NormalTok{ X\_23[common, , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}

\CommentTok{\#fit the model}
\NormalTok{mod.lfmm\_23 }\OtherTok{\textless{}{-}} \FunctionTok{lfmm\_ridge}\NormalTok{(}\AttributeTok{Y =}\NormalTok{ Y\_23, }
                        \AttributeTok{X =}\NormalTok{ X\_23, }
                        \AttributeTok{K =} \DecValTok{2}\NormalTok{)}
\NormalTok{pv\_23 }\OtherTok{\textless{}{-}} \FunctionTok{lfmm\_test}\NormalTok{(}\AttributeTok{Y =}\NormalTok{ Y\_23, }
                 \AttributeTok{X =}\NormalTok{ X\_23, }
                 \AttributeTok{lfmm =}\NormalTok{ mod.lfmm\_23, }
                 \AttributeTok{calibrate =} \StringTok{"gif"}\NormalTok{)}
\NormalTok{pvalues\_23 }\OtherTok{\textless{}{-}}\NormalTok{ pv\_23}\SpecialCharTok{$}\NormalTok{calibrated.pvalue}

\CommentTok{\#make the manhattan plot}
\NormalTok{plot\_data\_23 }\OtherTok{=} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{loci =}\NormalTok{ geno\_23[,}\DecValTok{1}\NormalTok{], }\AttributeTok{p\_val =}\NormalTok{ pv\_23}\SpecialCharTok{$}\NormalTok{pvalue[,}\DecValTok{1}\NormalTok{], }\AttributeTok{calibrated.pvalue =}\NormalTok{ pv\_23}\SpecialCharTok{$}\NormalTok{calibrated.pvalue[,}\DecValTok{1}\NormalTok{]) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{separate\_wider\_delim}\NormalTok{(loci, }\AttributeTok{delim =} \StringTok{":"}\NormalTok{, }\AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"chr"}\NormalTok{, }\StringTok{"bp"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(chr, }\StringTok{"Chr"}\NormalTok{)) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{mutate}\NormalTok{(}\AttributeTok{p.bonf =} \FunctionTok{p.adjust}\NormalTok{(p\_val, }\AttributeTok{method =} \StringTok{"bonferroni"}\NormalTok{),}
\AttributeTok{bp =} \FunctionTok{as.numeric}\NormalTok{(bp))}


\NormalTok{manhattan\_23 }\OtherTok{=} \FunctionTok{plot\_manhattan}\NormalTok{(plot\_data\_23,}
                        \AttributeTok{chr\_col =} \StringTok{"chr"}\NormalTok{,}
                        \AttributeTok{pos\_col =} \StringTok{"bp"}\NormalTok{,}
                        \AttributeTok{value\_col =} \StringTok{"calibrated.pvalue"}\NormalTok{,}
                        \AttributeTok{transform =} \StringTok{"neglog10"}\NormalTok{,}
                        \AttributeTok{title =} \StringTok{"Light association"}\NormalTok{,}
                        \AttributeTok{highlight\_top\_n =} \DecValTok{20}\NormalTok{)}

\CommentTok{\# Save plot}
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"light\_interaction23.png"}\NormalTok{, manhattan\_23, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{300}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prep\_manhattan\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data,}
                                \AttributeTok{chr\_col =} \StringTok{"chr"}\NormalTok{,}
                                \AttributeTok{pos\_col =} \StringTok{"bp"}\NormalTok{,}
                                \AttributeTok{value\_col =} \StringTok{"calibrated.pvalue"}\NormalTok{,}
                                \AttributeTok{transform =} \StringTok{"neglog10"}\NormalTok{) \{}
\NormalTok{  plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rename}\NormalTok{(}\AttributeTok{chr =} \SpecialCharTok{!!}\FunctionTok{sym}\NormalTok{(chr\_col),}
           \AttributeTok{pos =} \SpecialCharTok{!!}\FunctionTok{sym}\NormalTok{(pos\_col),}
           \AttributeTok{value =} \SpecialCharTok{!!}\FunctionTok{sym}\NormalTok{(value\_col))}
  
  \ControlFlowTok{if}\NormalTok{ (transform }\SpecialCharTok{==} \StringTok{"log10"}\NormalTok{) \{}
\NormalTok{    plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{plot\_value =} \FunctionTok{log10}\NormalTok{(value))}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (transform }\SpecialCharTok{==} \StringTok{"neglog10"}\NormalTok{) \{}
\NormalTok{    plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{plot\_value =} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(value))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{plot\_value =}\NormalTok{ value)}
\NormalTok{  \}}
  
\NormalTok{  plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(plot\_value), }\SpecialCharTok{!}\FunctionTok{is.infinite}\NormalTok{(plot\_value)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{chr\_num =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{D"}\NormalTok{, }\StringTok{""}\NormalTok{, chr))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(chr\_num, pos)}
  
\NormalTok{  chr\_lengths }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(chr, chr\_num) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{chr\_len =} \FunctionTok{max}\NormalTok{(pos), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(chr\_num) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{tot =} \FunctionTok{cumsum}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(chr\_len)) }\SpecialCharTok{{-}}\NormalTok{ chr\_len)}
  
\NormalTok{  plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{left\_join}\NormalTok{(chr\_lengths }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(chr, tot), }\AttributeTok{by =} \StringTok{"chr"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{BPcum =}\NormalTok{ pos }\SpecialCharTok{+}\NormalTok{ tot)}
  
\NormalTok{  axis\_df }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(chr, chr\_num) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarize}\NormalTok{(}\AttributeTok{center =}\NormalTok{ (}\FunctionTok{max}\NormalTok{(BPcum) }\SpecialCharTok{+} \FunctionTok{min}\NormalTok{(BPcum)) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{, }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(chr\_num)}
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{plot\_data =}\NormalTok{ plot\_data, }\AttributeTok{axis\_df =}\NormalTok{ axis\_df)}
\NormalTok{\}}

\NormalTok{prep22 }\OtherTok{\textless{}{-}} \FunctionTok{prep\_manhattan\_data}\NormalTok{(plot\_data, }
                              \AttributeTok{chr\_col =} \StringTok{"chr"}\NormalTok{,}
                              \AttributeTok{pos\_col =} \StringTok{"bp"}\NormalTok{,}
                              \AttributeTok{value\_col =} \StringTok{"calibrated.pvalue"}\NormalTok{,}
                              \AttributeTok{transform =} \StringTok{"neglog10"}\NormalTok{)}

\NormalTok{prep23 }\OtherTok{\textless{}{-}} \FunctionTok{prep\_manhattan\_data}\NormalTok{(plot\_data\_23,}
                              \AttributeTok{chr\_col =} \StringTok{"chr"}\NormalTok{,}
                              \AttributeTok{pos\_col =} \StringTok{"bp"}\NormalTok{,}
                              \AttributeTok{value\_col =} \StringTok{"calibrated.pvalue"}\NormalTok{,}
                              \AttributeTok{transform =} \StringTok{"neglog10"}\NormalTok{)}

\NormalTok{overlay\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(}
\NormalTok{  prep22}\SpecialCharTok{$}\NormalTok{plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \StringTok{"2022"}\NormalTok{),}
\NormalTok{  prep23}\SpecialCharTok{$}\NormalTok{plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \StringTok{"2023"}\NormalTok{)}
\NormalTok{)}

\NormalTok{overlay\_plot }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(overlay\_df,}
                       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ BPcum, }\AttributeTok{y =}\NormalTok{ plot\_value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ year),}
             \AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"2022"} \OtherTok{=} \StringTok{"\#56B4E9"}\NormalTok{,}
                                \StringTok{"2023"} \OtherTok{=} \StringTok{"\#E69F00"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =}\NormalTok{ prep22}\SpecialCharTok{$}\NormalTok{axis\_df}\SpecialCharTok{$}\NormalTok{center,}
                     \AttributeTok{labels =}\NormalTok{ prep22}\SpecialCharTok{$}\NormalTok{axis\_df}\SpecialCharTok{$}\NormalTok{chr,}
                     \AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\FloatTok{0.01}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Light association (2022 vs 2023 overlay)"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Chromosome"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"{-}log10(calibrated p{-}value)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \DecValTok{10}\NormalTok{)}
\NormalTok{  )}

\FunctionTok{print}\NormalTok{(overlay\_plot)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{FQ3_files/figure-latex/unnamed-chunk-4-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{top1\_UCD }\OtherTok{=}\NormalTok{ plot\_data }\SpecialCharTok{|\textgreater{}}
\FunctionTok{slice\_min}\NormalTok{(calibrated.pvalue, }\AttributeTok{prop=}\FloatTok{0.001}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{select}\NormalTok{(}\AttributeTok{seqid =}\NormalTok{ chr, bp, p\_val, calibrated.pvalue, p.bonf)}
\FunctionTok{write\_tsv}\NormalTok{(top1\_UCD, }\StringTok{"top1\_UCD\_loc.tsv"}\NormalTok{)}

\NormalTok{top1\_WL2 }\OtherTok{=}\NormalTok{ plot\_data\_23 }\SpecialCharTok{|\textgreater{}}
\FunctionTok{slice\_min}\NormalTok{(calibrated.pvalue, }\AttributeTok{prop=}\FloatTok{0.001}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{select}\NormalTok{(}\AttributeTok{seqid =}\NormalTok{ chr, bp, p\_val, calibrated.pvalue, p.bonf)}
\FunctionTok{write\_tsv}\NormalTok{(top1\_WL2, }\StringTok{"top1\_WL2\_loc.tsv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w }\OtherTok{\textless{}{-}} \FloatTok{1e5} \SpecialCharTok{/} \DecValTok{2}

\NormalTok{reg22 }\OtherTok{\textless{}{-}}\NormalTok{ top1\_UCD }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{transmute}\NormalTok{(seqid, }\AttributeTok{bp22=}\NormalTok{bp,}\AttributeTok{start =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ w, }\AttributeTok{end =}\NormalTok{ bp }\SpecialCharTok{+}\NormalTok{ w, }\AttributeTok{p22 =}\NormalTok{ calibrated.pvalue)}

\NormalTok{reg23 }\OtherTok{\textless{}{-}}\NormalTok{ top1\_WL2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{transmute}\NormalTok{(seqid, }\AttributeTok{bp23=}\NormalTok{bp,}\AttributeTok{start =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ w, }\AttributeTok{end =}\NormalTok{ bp }\SpecialCharTok{+}\NormalTok{ w, }\AttributeTok{p23 =}\NormalTok{ calibrated.pvalue)}

\NormalTok{overlap\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\NormalTok{chroms }\OtherTok{\textless{}{-}} \FunctionTok{intersect}\NormalTok{(reg22}\SpecialCharTok{$}\NormalTok{seqid, reg23}\SpecialCharTok{$}\NormalTok{seqid)}

\ControlFlowTok{for}\NormalTok{ (chr\_i }\ControlFlowTok{in}\NormalTok{ chroms) \{}
  
\NormalTok{  d1 }\OtherTok{\textless{}{-}}\NormalTok{ reg22 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(seqid }\SpecialCharTok{==}\NormalTok{ chr\_i)}
\NormalTok{  d2 }\OtherTok{\textless{}{-}}\NormalTok{ reg23 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(seqid }\SpecialCharTok{==}\NormalTok{ chr\_i)}
  
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(d1) }\SpecialCharTok{\textgreater{}} \DecValTok{0} \SpecialCharTok{\&} \FunctionTok{nrow}\NormalTok{(d2) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}}\NormalTok{ fuzzyjoin}\SpecialCharTok{::}\FunctionTok{interval\_inner\_join}\NormalTok{(}
\NormalTok{      d1, d2,}
      \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"start"}\NormalTok{, }\StringTok{"end"}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{mutate}\NormalTok{(}
        \AttributeTok{chr =}\NormalTok{ chr\_i,}
        \AttributeTok{overlap\_start =} \FunctionTok{pmax}\NormalTok{(start.x, start.y),}
        \AttributeTok{overlap\_end   =} \FunctionTok{pmin}\NormalTok{(end.x, end.y),}
        \AttributeTok{width         =}\NormalTok{ overlap\_end }\SpecialCharTok{{-}}\NormalTok{ overlap\_start}
\NormalTok{      ) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{filter}\NormalTok{(width }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
    
\NormalTok{    overlap\_list[[chr\_i]] }\OtherTok{\textless{}{-}}\NormalTok{ tmp}
\NormalTok{  \}}
\NormalTok{\}}

\NormalTok{overlap }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(overlap\_list)}
\NormalTok{overlap\_clean }\OtherTok{\textless{}{-}}\NormalTok{ overlap }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}
    \AttributeTok{chr      =}\NormalTok{ chr,}
    \AttributeTok{start22  =}\NormalTok{ start.x,}
    \AttributeTok{end22    =}\NormalTok{ end.x,}
    \AttributeTok{p22      =}\NormalTok{ p22, }
    \AttributeTok{start23  =}\NormalTok{ start.y,}
    \AttributeTok{end23    =}\NormalTok{ end.y,}
    \AttributeTok{p23      =}\NormalTok{ p23}
\NormalTok{  )}
\FunctionTok{head}\NormalTok{(overlap)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 14
##   seqid.x    bp22 start.x   end.x      p22 seqid.y   bp23 start.y  end.y     p23
##   <chr>     <dbl>   <dbl>   <dbl>    <dbl> <chr>    <dbl>   <dbl>  <dbl>   <dbl>
## 1 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.68e6 4632775 4.73e6 1.31e-8
## 2 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.68e6 4632129 4.73e6 4.63e-6
## 3 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.68e6 4629588 4.73e6 6.57e-6
## 4 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.68e6 4633436 4.73e6 6.90e-6
## 5 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.68e6 4631570 4.73e6 7.40e-6
## 6 Chr4    4668094 4618094 4718094  8.01e-9 Chr4    4.66e6 4605375 4.71e6 1.02e-5
## # i 4 more variables: chr <chr>, overlap_start <dbl>, overlap_end <dbl>,
## #   width <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df22 }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{logp =} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(calibrated.pvalue))}
\NormalTok{sig22 }\OtherTok{\textless{}{-}}\NormalTok{ df22 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_max}\NormalTok{(logp, }\AttributeTok{prop =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{df23 }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data\_23 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{logp =} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(calibrated.pvalue))}
\NormalTok{sig23 }\OtherTok{\textless{}{-}}\NormalTok{ df23 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_max}\NormalTok{(logp, }\AttributeTok{prop =} \FloatTok{0.01}\NormalTok{)}

\CommentTok{\#combine SNPs within 50kb to make a peak region}
\NormalTok{merge\_peaks }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{max\_gap =} \DecValTok{50000}\NormalTok{)\{}
\NormalTok{  df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(chr, bp) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(chr) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gap =}\NormalTok{ bp }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(bp, }\AttributeTok{default =} \FunctionTok{first}\NormalTok{(bp)),}
           \AttributeTok{new\_region =}\NormalTok{ gap }\SpecialCharTok{\textgreater{}}\NormalTok{ max\_gap,}
           \AttributeTok{region\_id =} \FunctionTok{cumsum}\NormalTok{(new\_region)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(chr, region\_id) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}
      \AttributeTok{region\_start =} \FunctionTok{min}\NormalTok{(bp),}
      \AttributeTok{region\_end   =} \FunctionTok{max}\NormalTok{(bp),}
      \AttributeTok{peak\_snp     =}\NormalTok{ bp[}\FunctionTok{which.max}\NormalTok{(logp)],}
      \AttributeTok{peak\_logp    =} \FunctionTok{max}\NormalTok{(logp),}
      \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{    )}
\NormalTok{\}}

\NormalTok{peaks22 }\OtherTok{\textless{}{-}} \FunctionTok{merge\_peaks}\NormalTok{(sig22)}
\NormalTok{peaks23 }\OtherTok{\textless{}{-}} \FunctionTok{merge\_peaks}\NormalTok{(sig23)}

\NormalTok{peak\_overlap }\OtherTok{\textless{}{-}} \FunctionTok{interval\_inner\_join}\NormalTok{(}
\NormalTok{  peaks22 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename}\NormalTok{(}\AttributeTok{start =}\NormalTok{ region\_start, }\AttributeTok{end =}\NormalTok{ region\_end),}
\NormalTok{  peaks23 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename}\NormalTok{(}\AttributeTok{start =}\NormalTok{ region\_start, }\AttributeTok{end =}\NormalTok{ region\_end),}
  \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"start"}\NormalTok{, }\StringTok{"end"}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{overlap\_start =} \FunctionTok{pmax}\NormalTok{(start.x, start.y),}
    \AttributeTok{overlap\_end   =} \FunctionTok{pmin}\NormalTok{(end.x, end.y),}
    \AttributeTok{width =}\NormalTok{ overlap\_end }\SpecialCharTok{{-}}\NormalTok{ overlap\_start}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(width }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}

\NormalTok{peak\_overlap}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 132 x 15
##    chr.x region_id.x  start.x    end.x peak_snp.x peak_logp.x chr.y region_id.y
##    <chr>       <int>    <dbl>    <dbl>      <dbl>       <dbl> <chr>       <int>
##  1 Chr1            6  3189599  3193702    3189599        4.45 Chr6            3
##  2 Chr1            7  3597659  3622098    3622098        5.39 Chr7           10
##  3 Chr1           19 10059687 10084759   10084759        6.36 Chr1           11
##  4 Chr1           19 10059687 10084759   10084759        6.36 Chr4           23
##  5 Chr1           21 10689169 10689203   10689203        6.14 Chr4           26
##  6 Chr1           25 12686280 12686428   12686280        4.95 Chr6           24
##  7 Chr1           25 12686280 12686428   12686280        4.95 Chr7           34
##  8 Chr1           27 13822575 13824709   13822575        7.10 Chr1           30
##  9 Chr1           39 20168900 20170476   20170381        4.11 Chr1           46
## 10 Chr1           39 20168900 20170476   20170381        4.11 Chr6           54
## # i 122 more rows
## # i 7 more variables: start.y <dbl>, end.y <dbl>, peak_snp.y <dbl>,
## #   peak_logp.y <dbl>, overlap_start <dbl>, overlap_end <dbl>, width <dbl>
\end{verbatim}

upload the gene table and find the nearby genes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{genes }\OtherTok{=} \FunctionTok{read\_tsv}\NormalTok{(}\StringTok{"Data/gene\_description.tsv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 34643 Columns: 6
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr (4): seqid, strand, gene_id, description
## dbl (2): start, end
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{window\_size }\OtherTok{=} \DecValTok{100000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{top20\_UCD }\OtherTok{=}\NormalTok{ plot\_data }\SpecialCharTok{|\textgreater{}}
\FunctionTok{slice\_min}\NormalTok{(calibrated.pvalue, }\AttributeTok{n =} \DecValTok{20}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{select}\NormalTok{(}\AttributeTok{seqid =}\NormalTok{ chr, bp, p\_val, calibrated.pvalue, p.bonf)}
\FunctionTok{write\_tsv}\NormalTok{(top20\_UCD, }\StringTok{"top20\_UCD\_loc.tsv"}\NormalTok{)}

\NormalTok{top20\_WL2 }\OtherTok{=}\NormalTok{ plot\_data\_23 }\SpecialCharTok{|\textgreater{}}
\FunctionTok{slice\_min}\NormalTok{(calibrated.pvalue, }\AttributeTok{n =} \DecValTok{20}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{select}\NormalTok{(}\AttributeTok{seqid =}\NormalTok{ chr, bp, p\_val, calibrated.pvalue, p.bonf)}
\FunctionTok{write\_tsv}\NormalTok{(top20\_WL2, }\StringTok{"top20\_WL2\_loc.tsv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{genes\_near\_snps\_UCD }\OtherTok{=}\NormalTok{ top20\_UCD }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{left\_join}\NormalTok{(genes, }\AttributeTok{by =} \StringTok{"seqid"}\NormalTok{, }\AttributeTok{relationship =} \StringTok{"many{-}to{-}many"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Calculate distances}
    \AttributeTok{dist\_to\_start =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ start,}
    \AttributeTok{dist\_to\_end =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ end,}
    
    \CommentTok{\# Check if SNP is within gene body}
    \AttributeTok{in\_gene =}\NormalTok{ bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ start }\SpecialCharTok{\&}\NormalTok{ bp }\SpecialCharTok{\textless{}=}\NormalTok{ end,}
    
    \CommentTok{\# Check if SNP is within window (upstream or downstream)}
    \AttributeTok{in\_window =}\NormalTok{ (bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ (start }\SpecialCharTok{{-}}\NormalTok{ window\_size) }\SpecialCharTok{\&}\NormalTok{ bp }\SpecialCharTok{\textless{}=}\NormalTok{ (end }\SpecialCharTok{+}\NormalTok{ window\_size))}
\NormalTok{  ) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(in\_window) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Categorize position}
    \AttributeTok{position =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      in\_gene }\SpecialCharTok{\textasciitilde{}} \StringTok{"in\_gene"}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textless{}}\NormalTok{ start }\SpecialCharTok{\textasciitilde{}} \StringTok{"upstream"}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textgreater{}}\NormalTok{ end }\SpecialCharTok{\textasciitilde{}} \StringTok{"downstream"}
\NormalTok{    ),}
    \AttributeTok{distance =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      in\_gene }\SpecialCharTok{\textasciitilde{}} \DecValTok{0}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textless{}}\NormalTok{ start }\SpecialCharTok{\textasciitilde{}}\NormalTok{ start }\SpecialCharTok{{-}}\NormalTok{ bp,}
\NormalTok{      bp }\SpecialCharTok{\textgreater{}}\NormalTok{ end }\SpecialCharTok{\textasciitilde{}}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ end}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{arrange}\NormalTok{(seqid, bp, distance)}

\CommentTok{\#write\_tsv(genes\_near\_snps\_UCD, "UCD\_2022\_genes.tsv")}
\NormalTok{genes\_near\_snps\_UCD}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 511 x 16
##    seqid     bp      p_val calibrated.pvalue p.bonf  start    end strand gene_id
##    <chr>  <dbl>      <dbl>             <dbl>  <dbl>  <dbl>  <dbl> <chr>  <chr>  
##  1 Chr1  102763 0.00000136          2.41e-21  0.131  99758 103380 +      Sdiv_p~
##  2 Chr1  102763 0.00000136          2.41e-21  0.131 103721 107316 -      Sdiv_p~
##  3 Chr1  102763 0.00000136          2.41e-21  0.131  98238 100014 -      Sdiv_p~
##  4 Chr1  102763 0.00000136          2.41e-21  0.131  92330  97787 -      Sdiv_p~
##  5 Chr1  102763 0.00000136          2.41e-21  0.131 108145 110992 +      Sdiv_p~
##  6 Chr1  102763 0.00000136          2.41e-21  0.131 109567 110014 -      Sdiv_p~
##  7 Chr1  102763 0.00000136          2.41e-21  0.131 111553 114116 +      Sdiv_p~
##  8 Chr1  102763 0.00000136          2.41e-21  0.131  85739  92723 +      Sdiv_p~
##  9 Chr1  102763 0.00000136          2.41e-21  0.131 115206 121670 -      Sdiv_p~
## 10 Chr1  102763 0.00000136          2.41e-21  0.131 118937 119409 +      Sdiv_p~
## # i 501 more rows
## # i 7 more variables: description <chr>, dist_to_start <dbl>,
## #   dist_to_end <dbl>, in_gene <lgl>, in_window <lgl>, position <chr>,
## #   distance <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{genes\_near\_snps\_WL2 }\OtherTok{=}\NormalTok{ top20\_WL2 }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{left\_join}\NormalTok{(genes, }\AttributeTok{by =} \StringTok{"seqid"}\NormalTok{, }\AttributeTok{relationship =} \StringTok{"many{-}to{-}many"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Calculate distances}
    \AttributeTok{dist\_to\_start =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ start,}
    \AttributeTok{dist\_to\_end =}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ end,}
    
    \CommentTok{\# Check if SNP is within gene body}
    \AttributeTok{in\_gene =}\NormalTok{ bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ start }\SpecialCharTok{\&}\NormalTok{ bp }\SpecialCharTok{\textless{}=}\NormalTok{ end,}
    
    \CommentTok{\# Check if SNP is within window (upstream or downstream)}
    \AttributeTok{in\_window =}\NormalTok{ (bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ (start }\SpecialCharTok{{-}}\NormalTok{ window\_size) }\SpecialCharTok{\&}\NormalTok{ bp }\SpecialCharTok{\textless{}=}\NormalTok{ (end }\SpecialCharTok{+}\NormalTok{ window\_size))}
\NormalTok{  ) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{filter}\NormalTok{(in\_window) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Categorize position}
    \AttributeTok{position =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      in\_gene }\SpecialCharTok{\textasciitilde{}} \StringTok{"in\_gene"}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textless{}}\NormalTok{ start }\SpecialCharTok{\textasciitilde{}} \StringTok{"upstream"}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textgreater{}}\NormalTok{ end }\SpecialCharTok{\textasciitilde{}} \StringTok{"downstream"}
\NormalTok{    ),}
    \AttributeTok{distance =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      in\_gene }\SpecialCharTok{\textasciitilde{}} \DecValTok{0}\NormalTok{,}
\NormalTok{      bp }\SpecialCharTok{\textless{}}\NormalTok{ start }\SpecialCharTok{\textasciitilde{}}\NormalTok{ start }\SpecialCharTok{{-}}\NormalTok{ bp,}
\NormalTok{      bp }\SpecialCharTok{\textgreater{}}\NormalTok{ end }\SpecialCharTok{\textasciitilde{}}\NormalTok{ bp }\SpecialCharTok{{-}}\NormalTok{ end}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{arrange}\NormalTok{(seqid, bp, distance)}

\CommentTok{\#write\_tsv(genes\_near\_snps\_WL2, "WL2\_2023\_genes.tsv")}
\NormalTok{genes\_near\_snps\_WL2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 278 x 16
##    seqid       bp    p_val calibrated.pvalue p.bonf  start    end strand gene_id
##    <chr>    <dbl>    <dbl>             <dbl>  <dbl>  <dbl>  <dbl> <chr>  <chr>  
##  1 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 +      Sdiv_p~
##  2 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 +      Sdiv_p~
##  3 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 +      Sdiv_p~
##  4 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 -      Sdiv_p~
##  5 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 -      Sdiv_p~
##  6 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 -      Sdiv_p~
##  7 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 +      Sdiv_p~
##  8 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 -      Sdiv_p~
##  9 Chr1  21374778  1.39e-5       0.000000163      1 2.14e7 2.14e7 +      Sdiv_p~
## 10 Chr1  21374778  1.39e-5       0.000000163      1 2.13e7 2.14e7 +      Sdiv_p~
## # i 268 more rows
## # i 7 more variables: description <chr>, dist_to_start <dbl>,
## #   dist_to_end <dbl>, in_gene <lgl>, in_window <lgl>, position <chr>,
## #   distance <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prioritized\_genes }\OtherTok{\textless{}{-}}\NormalTok{ genes\_near\_snps\_UCD }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gene\_id, description, seqid) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n\_snps =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{min\_distance =} \FunctionTok{min}\NormalTok{(distance),}
    \AttributeTok{any\_in\_gene =} \FunctionTok{any}\NormalTok{(position }\SpecialCharTok{==} \StringTok{"in\_gene"}\NormalTok{),}
    \AttributeTok{any\_promoter =} \FunctionTok{any}\NormalTok{(distance }\SpecialCharTok{\textless{}=} \DecValTok{1000} \SpecialCharTok{\&}\NormalTok{ position}\SpecialCharTok{==}\StringTok{"upstream"}\NormalTok{),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{priority\_score =}
      \DecValTok{3} \SpecialCharTok{*}\NormalTok{ any\_in\_gene }\SpecialCharTok{+}
      \DecValTok{2} \SpecialCharTok{*}\NormalTok{ any\_promoter }\SpecialCharTok{+}
      \DecValTok{1} \SpecialCharTok{*}\NormalTok{ (min\_distance }\SpecialCharTok{\textless{}=} \DecValTok{3000}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{      n\_snps}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(priority\_score), min\_distance)}

\NormalTok{prioritized\_genes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 358 x 8
##    gene_id        description seqid n_snps min_distance any_in_gene any_promoter
##    <chr>          <chr>       <chr>  <int>        <dbl> <lgl>       <lgl>       
##  1 Sdiv_ptg00001~ Similar to~ Chr4       5            0 TRUE        FALSE       
##  2 Sdiv_ptg00001~ Similar to~ Chr1       2            0 TRUE        FALSE       
##  3 Sdiv_ptg00001~ Similar to~ Chr1       2            0 TRUE        FALSE       
##  4 Sdiv_ptg00001~ Similar to~ Chr4       5         1652 FALSE       FALSE       
##  5 Sdiv_ptg00000~ Similar to~ Chr11      1            0 TRUE        FALSE       
##  6 Sdiv_ptg00000~ Protein of~ Chr3       1            0 TRUE        FALSE       
##  7 Sdiv_ptg00000~ Similar to~ Chr9       1            0 TRUE        FALSE       
##  8 Sdiv_ptg00000~ Similar to~ Chr14      1            0 TRUE        FALSE       
##  9 Sdiv_ptg00000~ Similar to~ Chr2       1            0 TRUE        FALSE       
## 10 Sdiv_ptg00001~ Protein of~ Chr1       2          698 FALSE       TRUE        
## # i 348 more rows
## # i 1 more variable: priority_score <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prioritized\_genes }\OtherTok{\textless{}{-}}\NormalTok{ genes\_near\_snps\_WL2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gene\_id, description, seqid) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n\_snps =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{min\_distance =} \FunctionTok{min}\NormalTok{(distance),}
    \AttributeTok{any\_in\_gene =} \FunctionTok{any}\NormalTok{(position }\SpecialCharTok{==} \StringTok{"in\_gene"}\NormalTok{),}
    \AttributeTok{any\_promoter =} \FunctionTok{any}\NormalTok{(distance }\SpecialCharTok{\textless{}=} \DecValTok{1000} \SpecialCharTok{\&}\NormalTok{ position}\SpecialCharTok{==}\StringTok{"upstream"}\NormalTok{),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{priority\_score =}
      \DecValTok{3} \SpecialCharTok{*}\NormalTok{ any\_in\_gene }\SpecialCharTok{+}
      \DecValTok{2} \SpecialCharTok{*}\NormalTok{ any\_promoter }\SpecialCharTok{+}
      \DecValTok{1} \SpecialCharTok{*}\NormalTok{ (min\_distance }\SpecialCharTok{\textless{}=} \DecValTok{3000}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{      n\_snps}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(priority\_score), min\_distance)}

\NormalTok{prioritized\_genes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 262 x 8
##    gene_id        description seqid n_snps min_distance any_in_gene any_promoter
##    <chr>          <chr>       <chr>  <int>        <dbl> <lgl>       <lgl>       
##  1 Sdiv_ptg00000~ Similar to~ Chr10      1            0 TRUE        FALSE       
##  2 Sdiv_ptg00000~ Similar to~ Chr3       1            0 TRUE        FALSE       
##  3 Sdiv_ptg00001~ Similar to~ Chr4       1            0 TRUE        FALSE       
##  4 Sdiv_ptg00001~ Similar to~ Chr1       1            0 TRUE        FALSE       
##  5 Sdiv_ptg00001~ Protein of~ Chr1       1            0 TRUE        FALSE       
##  6 Sdiv_ptg00000~ Protein of~ Chr3       1          694 FALSE       TRUE        
##  7 Sdiv_ptg00000~ Similar to~ Chr8       2         2864 FALSE       FALSE       
##  8 Sdiv_ptg00000~ Similar to~ Chr9       1         1075 FALSE       FALSE       
##  9 Sdiv_ptg00001~ Similar to~ Chr4       1         1614 FALSE       FALSE       
## 10 Sdiv_ptg00000~ Protein of~ Chr8       1         1749 FALSE       FALSE       
## # i 252 more rows
## # i 1 more variable: priority_score <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region\_start }\OtherTok{\textless{}{-}} \DecValTok{4618094}
\NormalTok{region\_end   }\OtherTok{\textless{}{-}} \DecValTok{4718094}

\CommentTok{\# 2022 subset}
\NormalTok{chr4\_22 }\OtherTok{\textless{}{-}}\NormalTok{ prep22}\SpecialCharTok{$}\NormalTok{plot\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(chr }\SpecialCharTok{==} \StringTok{"Chr4"}\NormalTok{,}
\NormalTok{         pos }\SpecialCharTok{\textgreater{}=}\NormalTok{ region\_start,}
\NormalTok{         pos }\SpecialCharTok{\textless{}=}\NormalTok{ region\_end) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{logp\_signed =}\NormalTok{ plot\_value)   }

\CommentTok{\# 2023 subset}
\NormalTok{chr4\_23 }\OtherTok{\textless{}{-}}\NormalTok{ prep23}\SpecialCharTok{$}\NormalTok{plot\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(chr }\SpecialCharTok{==} \StringTok{"Chr4"}\NormalTok{,}
\NormalTok{         pos }\SpecialCharTok{\textgreater{}=}\NormalTok{ region\_start,}
\NormalTok{         pos }\SpecialCharTok{\textless{}=}\NormalTok{ region\_end) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{logp\_signed =} \SpecialCharTok{{-}}\NormalTok{plot\_value)  }

\CommentTok{\# merge}
\NormalTok{mirror\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(}
\NormalTok{  chr4\_22 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \StringTok{"2022"}\NormalTok{),}
\NormalTok{  chr4\_23 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \StringTok{"2023"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{(mirror\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pos, }\AttributeTok{y =}\NormalTok{ logp\_signed, }\AttributeTok{color =}\NormalTok{ year)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"Mirrored Manhattan Plot (Chr4: 4.624.72 Mb)"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Position on Chr4"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"+/{-} {-}log10(p)"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"2022"} \OtherTok{=} \StringTok{"\#56B4E9"}\NormalTok{, }\StringTok{"2023"} \OtherTok{=} \StringTok{"\#E69F00"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{FQ3_files/figure-latex/unnamed-chunk-14-1.pdf}}

1.Create side-by-side plots of BLUP vs.~allele frequency for the two
closest significant SNPs from the UCD and WL2 gardens

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#find two closest significant SNPs around 4670000}
\NormalTok{target\_pos }\OtherTok{\textless{}{-}} \DecValTok{4670000}
\NormalTok{tol }\OtherTok{\textless{}{-}} \DecValTok{30000}  

\CommentTok{\#UCD 2022}
\NormalTok{ucd\_target }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(chr }\SpecialCharTok{==} \StringTok{"Chr4"}\NormalTok{,}
\NormalTok{         bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ target\_pos }\SpecialCharTok{{-}}\NormalTok{ tol,}
\NormalTok{         bp }\SpecialCharTok{\textless{}=}\NormalTok{ target\_pos }\SpecialCharTok{+}\NormalTok{ tol) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(calibrated.pvalue) }\SpecialCharTok{\%\textgreater{}\%}    
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{)}

\FunctionTok{print}\NormalTok{(ucd\_target)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   chr        bp    p_val calibrated.pvalue p.bonf
##   <chr>   <dbl>    <dbl>             <dbl>  <dbl>
## 1 Chr4  4668094 0.000104     0.00000000801      1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#WL2 2023}
\NormalTok{wl2\_target }\OtherTok{\textless{}{-}}\NormalTok{ plot\_data\_23 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(chr }\SpecialCharTok{==} \StringTok{"Chr4"}\NormalTok{,}
\NormalTok{         bp }\SpecialCharTok{\textgreater{}=}\NormalTok{ target\_pos }\SpecialCharTok{{-}}\NormalTok{ tol,}
\NormalTok{         bp }\SpecialCharTok{\textless{}=}\NormalTok{ target\_pos }\SpecialCharTok{+}\NormalTok{ tol) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(calibrated.pvalue) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{)}

\FunctionTok{print}\NormalTok{(wl2\_target)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   chr        bp      p_val calibrated.pvalue p.bonf
##   <chr>   <dbl>      <dbl>             <dbl>  <dbl>
## 1 Chr4  4682775 0.00000488      0.0000000131  0.877
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{geno\_table\_22 }\OtherTok{=}\NormalTok{ Y}
\FunctionTok{colnames}\NormalTok{(geno\_table\_22)}\OtherTok{=}\NormalTok{geno\_22[, }\DecValTok{1}\NormalTok{]}
\NormalTok{geno\_table\_23 }\OtherTok{=}\NormalTok{ Y\_23}
\FunctionTok{colnames}\NormalTok{(geno\_table\_23) }\OtherTok{=}\NormalTok{ geno\_23[, }\DecValTok{1}\NormalTok{]}

\NormalTok{freq\_UCD }\OtherTok{=} \FunctionTok{as.data.frame}\NormalTok{(X) }\SpecialCharTok{\%\textgreater{}\%}
 \FunctionTok{rownames\_to\_column}\NormalTok{(}\AttributeTok{var =} \StringTok{"Population"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{mutate}\NormalTok{(}\AttributeTok{UCD\_SNP =} \FunctionTok{as.numeric}\NormalTok{(geno\_table\_22[, }\StringTok{"Chr4:4668094"}\NormalTok{]))}
\NormalTok{freq\_WL2 }\OtherTok{=} \FunctionTok{as.data.frame}\NormalTok{(X\_23) }\SpecialCharTok{\%\textgreater{}\%}
 \FunctionTok{rownames\_to\_column}\NormalTok{(}\AttributeTok{var =} \StringTok{"Population"}\NormalTok{) }\SpecialCharTok{|\textgreater{}}
\FunctionTok{mutate}\NormalTok{(}\AttributeTok{WL2\_SNP =} \FunctionTok{as.numeric}\NormalTok{(geno\_table\_23[, }\StringTok{"Chr4:4682775"}\NormalTok{]))}
\NormalTok{freq\_plot\_both }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(freq\_UCD, freq\_WL2)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =}\NormalTok{ UCD\_SNP}\SpecialCharTok{:}\NormalTok{WL2\_SNP, }\AttributeTok{names\_to =} \StringTok{"loci"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"frequency"}\NormalTok{)}


\NormalTok{freq\_plot\_both }\SpecialCharTok{|\textgreater{}}
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ blup\_light, }\AttributeTok{y =}\NormalTok{ frequency, }\AttributeTok{label =}\NormalTok{ Population)) }\SpecialCharTok{+}
\FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }\AttributeTok{colour =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{size =} \DecValTok{6}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{loci, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{) }\SpecialCharTok{+}
\FunctionTok{theme\_minimal}\NormalTok{()}\SpecialCharTok{+}
\FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"BLUP light"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Allele frequency"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula = 'y ~ x'
\end{verbatim}

\begin{verbatim}
## Warning: Removed 35 rows containing non-finite outside the scale range
## (`stat_smooth()`).
\end{verbatim}

\begin{verbatim}
## Warning: The following aesthetics were dropped during statistical transformation: label.
## i This can happen when ggplot fails to infer the correct grouping structure in
##   the data.
## i Did you forget to specify a `group` aesthetic or to convert a numerical
##   variable into a factor?
## The following aesthetics were dropped during statistical transformation: label.
## i This can happen when ggplot fails to infer the correct grouping structure in
##   the data.
## i Did you forget to specify a `group` aesthetic or to convert a numerical
##   variable into a factor?
\end{verbatim}

\begin{verbatim}
## Warning: Removed 35 rows containing missing values or values outside the scale range
## (`geom_point()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 35 rows containing missing values or values outside the scale range
## (`geom_text_repel()`).
\end{verbatim}

\begin{verbatim}
## Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{FQ3_files/figure-latex/unnamed-chunk-16-1.pdf}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Plot the change in light intensity over time for both years.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#weekly solar radiation for UCD garden in 2022{-}2023 year}
\NormalTok{ucd\_met }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/UCD\_met\_data.csv"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{clean\_names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## New names:
## Rows: 188 Columns: 33
## -- Column specification
## -------------------------------------------------------- Delimiter: "," chr
## (17): Stn Name, CIMIS Region, Date, Jul, qc...9, qc...11, qc...13, qc...... dbl
## (15): Stn Id, ETo (in), Precip (in), Sol Rad (Ly/day), Avg Vap Pres (mBa... lgl
## (1): qc...7
## i Use `spec()` to retrieve the full column specification for this data. i
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## * `qc` -> `qc...7`
## * `qc` -> `qc...9`
## * `qc` -> `qc...11`
## * `qc` -> `qc...13`
## * `qc` -> `qc...15`
## * `qc` -> `qc...17`
## * `qc` -> `qc...19`
## * `qc` -> `qc...21`
## * `qc` -> `qc...23`
## * `qc` -> `qc...25`
## * `qc` -> `qc...27`
## * `qc` -> `qc...29`
## * `qc` -> `qc...31`
## * `qc` -> `qc...33`
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ucd\_daily }\OtherTok{\textless{}{-}}\NormalTok{ ucd\_met }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{date =} \FunctionTok{mdy}\NormalTok{(date),}
    \AttributeTok{year =} \FunctionTok{year}\NormalTok{(date),}
    \AttributeTok{week =} \FunctionTok{isoweek}\NormalTok{(date),}
    \AttributeTok{light=}\NormalTok{sol\_rad\_ly\_day,}
    \AttributeTok{garden=}\StringTok{"UCD"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(date, year, week, light,garden)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#weekly solar radiation for WL2 garden in 2023 year}
\NormalTok{wl2\_met }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/IntBioHalfHourTable\_clean.txt"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{clean\_names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 4063 Columns: 139
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl  (138): RECORD, BattV_Max, PTemp_C_Max, SlrW_Avg, SlrW_Max, SlrW_Min, Sl...
## dttm   (1): TIMESTAMP
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wl2\_daily }\OtherTok{\textless{}{-}}\NormalTok{ wl2\_met }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
  \AttributeTok{timestamp =} \FunctionTok{as.POSIXct}\NormalTok{(timestamp),}
  \AttributeTok{date =} \FunctionTok{as.Date}\NormalTok{(timestamp),}
  \AttributeTok{week=} \FunctionTok{isoweek}\NormalTok{(timestamp),}
  \AttributeTok{year =} \DecValTok{2023}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year,week,date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n\_records   =} \FunctionTok{n}\NormalTok{(),  }
    \AttributeTok{total\_J\_m2  =} \FunctionTok{sum}\NormalTok{(slr\_w\_avg, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{*} \DecValTok{1800}\NormalTok{,}
    \AttributeTok{light    =}\NormalTok{ total\_J\_m2 }\SpecialCharTok{/} \DecValTok{41840}\NormalTok{,}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(n\_records}\SpecialCharTok{\textgreater{}=}\DecValTok{40}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{garden=}\StringTok{"WL2"}\NormalTok{)}


\NormalTok{wl2\_weekly }\OtherTok{\textless{}{-}}\NormalTok{ wl2\_daily }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year, week) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{weekly\_avg\_SlrW =} \FunctionTok{mean}\NormalTok{(light, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iso\_week  =} \FunctionTok{paste0}\NormalTok{(year, }\StringTok{"{-}W"}\NormalTok{, }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%02d"}\NormalTok{, week)),}
    \AttributeTok{week =} \FunctionTok{ISOweek2date}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(iso\_week, }\StringTok{"{-}1"}\NormalTok{)) }\SpecialCharTok{{-}} \FunctionTok{days}\NormalTok{(}\DecValTok{1}\NormalTok{))}


\CommentTok{\#combine UCD and WL2}
\NormalTok{daily\_light }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(ucd\_daily, wl2\_daily)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{n\_records, }\SpecialCharTok{{-}}\NormalTok{total\_J\_m2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{daily\_light }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ date, }\AttributeTok{y =}\NormalTok{ light)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ garden, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{, }\AttributeTok{scales =} \StringTok{"free\_x"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"date"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Light (Ly/day)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{FQ3_files/figure-latex/unnamed-chunk-19-1.pdf}}

3.Generate a side-by-side plot of slope vs.~population, incorporating
the time factors.

UCD

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plant\_2223 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"C:/Users/Tobyz/Desktop/Toby/Maloof Lab/S.tort{-}light{-}growth/Data/UCD\_2022\_23\_size\_data\_combined.csv"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survey\_date =} \FunctionTok{as.Date}\NormalTok{(survey\_date, }\AttributeTok{format =} \StringTok{"\%m/\%d/\%Y"}\NormalTok{))}
\CommentTok{\#PID}
\NormalTok{pl\_gr }\OtherTok{\textless{}{-}}\NormalTok{ plant\_2223 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unite}\NormalTok{(}\StringTok{"PID"}\NormalTok{, pop}\SpecialCharTok{:}\NormalTok{rep, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{, }\AttributeTok{remove =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survey\_date =} \FunctionTok{as.Date}\NormalTok{(survey\_date))}
\CommentTok{\#filter out plants with negative growth \textless{} {-}5}
\NormalTok{pl\_gr\_cleaned }\OtherTok{\textless{}{-}}\NormalTok{ pl\_gr}

\ControlFlowTok{repeat}\NormalTok{ \{}
\NormalTok{  pl\_gr\_cleaned }\OtherTok{\textless{}{-}}\NormalTok{ pl\_gr\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{growth =}\NormalTok{ height }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(height)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(growth) }\SpecialCharTok{|}\NormalTok{ growth }\SpecialCharTok{\textgreater{}=} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{growth) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{  check }\OtherTok{\textless{}{-}}\NormalTok{ pl\_gr\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{growth =}\NormalTok{ height }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(height)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(growth }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(check) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\ControlFlowTok{break}
\NormalTok{\}}
\CommentTok{\#define daily growth rate}
\NormalTok{pl\_gr\_daily }\OtherTok{\textless{}{-}}\NormalTok{ pl\_gr\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{prev\_height =} \FunctionTok{lag}\NormalTok{(height),}
    \AttributeTok{prev\_date =} \FunctionTok{lag}\NormalTok{(survey\_date),}
    \AttributeTok{days\_elapsed =} \FunctionTok{as.numeric}\NormalTok{(survey\_date }\SpecialCharTok{{-}}\NormalTok{ prev\_date),}
    \AttributeTok{daily\_growth =}\NormalTok{ (height }\SpecialCharTok{{-}}\NormalTok{ prev\_height) }\SpecialCharTok{/}\NormalTok{ days\_elapsed}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{pl\_lt }\OtherTok{\textless{}{-}}\NormalTok{ pl\_gr\_daily }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{mean\_light\_ly\_day =} \FunctionTok{mean}\NormalTok{(}
\NormalTok{      ucd\_daily}\SpecialCharTok{$}\NormalTok{light[}
        \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(ucd\_daily}\SpecialCharTok{$}\NormalTok{date) }\SpecialCharTok{\&}
\NormalTok{        ucd\_daily}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textgreater{}}\NormalTok{ prev\_date }\SpecialCharTok{\&}
\NormalTok{        ucd\_daily}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textless{}=}\NormalTok{ survey\_date}
\NormalTok{      ],}
      \AttributeTok{na.rm =} \ConstantTok{TRUE}
\NormalTok{    ),}
    \AttributeTok{n\_days\_light =} \FunctionTok{sum}\NormalTok{(}
      \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(ucd\_daily}\SpecialCharTok{$}\NormalTok{date) }\SpecialCharTok{\&}
\NormalTok{      ucd\_daily}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textgreater{}}\NormalTok{ prev\_date }\SpecialCharTok{\&}
\NormalTok{      ucd\_daily}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textless{}=}\NormalTok{ survey\_date,}
      \AttributeTok{na.rm =} \ConstantTok{TRUE}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\CommentTok{\#Standardization}
\NormalTok{pl\_lt}\SpecialCharTok{$}\NormalTok{mean\_light\_ly\_day2 }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(pl\_lt}\SpecialCharTok{$}\NormalTok{mean\_light\_ly\_day, }\AttributeTok{center =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{mean\_lt }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(pl\_lt}\SpecialCharTok{$}\NormalTok{mean\_light\_ly\_day, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{sd\_lt   }\OtherTok{\textless{}{-}} \FunctionTok{sd}\NormalTok{(pl\_lt}\SpecialCharTok{$}\NormalTok{mean\_light\_ly\_day, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\#Change Data type}
\NormalTok{pl\_lt }\OtherTok{\textless{}{-}}\NormalTok{ pl\_lt }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{pop =} \FunctionTok{factor}\NormalTok{(pop),}
    \AttributeTok{PID        =} \FunctionTok{factor}\NormalTok{(PID),}
    \AttributeTok{block      =} \FunctionTok{factor}\NormalTok{(block)}
\NormalTok{  )}
\NormalTok{pl\_lt }\OtherTok{\textless{}{-}}\NormalTok{ pl\_lt }\SpecialCharTok{\%\textgreater{}\%}
\FunctionTok{arrange}\NormalTok{(survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
\FunctionTok{mutate}\NormalTok{(}
\AttributeTok{week =} \FunctionTok{as.integer}\NormalTok{((}\FunctionTok{as.numeric}\NormalTok{(survey\_date }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(survey\_date)) }\SpecialCharTok{\%/\%} \DecValTok{7}\NormalTok{) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\NormalTok{)}
\NormalTok{pl\_lt}\SpecialCharTok{$}\NormalTok{week\_f }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(pl\_lt}\SpecialCharTok{$}\NormalTok{week)}
\NormalTok{pl\_lt\_t.lmer }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(}
\NormalTok{daily\_growth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ mean\_light\_ly\_day2 }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ mean\_light\_ly\_day2 }\SpecialCharTok{|}\NormalTok{ pop) }\SpecialCharTok{+}\NormalTok{ (week}\SpecialCharTok{|}\NormalTok{pop),}
\AttributeTok{data =}\NormalTok{ pl\_lt, }\AttributeTok{REML =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## boundary (singular) fit: see help('isSingular')
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(pl\_lt\_t.lmer)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Linear mixed model fit by REML ['lmerMod']
## Formula: daily_growth ~ mean_light_ly_day2 + (1 + mean_light_ly_day2 |  
##     pop) + (week | pop)
##    Data: pl_lt
## 
## REML criterion at convergence: 1643.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.1992 -0.2980 -0.0511  0.1353  8.5496 
## 
## Random effects:
##  Groups   Name               Variance  Std.Dev. Corr
##  pop      (Intercept)        2.672e-02 0.163463     
##           mean_light_ly_day2 6.153e-03 0.078439 1.00
##  pop.1    (Intercept)        3.558e-04 0.018864     
##           week               4.769e-05 0.006906 1.00
##  Residual                    1.127e-01 0.335691     
## Number of obs: 2415, groups:  pop, 23
## 
## Fixed effects:
##                    Estimate Std. Error t value
## (Intercept)         0.13737    0.04727   2.906
## mean_light_ly_day2  0.07728    0.02339   3.305
## 
## Correlation of Fixed Effects:
##             (Intr)
## mn_lght_l_2 0.956 
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see help('isSingular')
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 1. Fixed effect slope}
\NormalTok{b\_fix }\OtherTok{\textless{}{-}} \FunctionTok{fixef}\NormalTok{(pl\_lt\_t.lmer)[}\StringTok{"mean\_light\_ly\_day2"}\NormalTok{]}

\CommentTok{\# 2. Random slope deviations (only from the \textquotesingle{}pop\textquotesingle{} block)}
\NormalTok{rand\_eff }\OtherTok{\textless{}{-}} \FunctionTok{ranef}\NormalTok{(pl\_lt\_t.lmer)}\SpecialCharTok{$}\NormalTok{pop}
\NormalTok{rand\_slope }\OtherTok{\textless{}{-}}\NormalTok{ rand\_eff[, }\StringTok{"mean\_light\_ly\_day2"}\NormalTok{]}

\CommentTok{\# 3. Get variance of the random slope (from the pop block only)}
\NormalTok{vc }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(}\FunctionTok{VarCorr}\NormalTok{(pl\_lt\_t.lmer))}

\NormalTok{rand\_slope\_var }\OtherTok{\textless{}{-}}\NormalTok{ vc }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(grp }\SpecialCharTok{==} \StringTok{"pop"}\NormalTok{, var1 }\SpecialCharTok{==} \StringTok{"mean\_light\_ly\_day2"}\NormalTok{, }\FunctionTok{is.na}\NormalTok{(var2)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(vcov)}

\NormalTok{rand\_slope\_sd }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(rand\_slope\_var)}

\CommentTok{\# 4. Construct slopes \& CI}
\NormalTok{pop\_slopes }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{pop        =} \FunctionTok{rownames}\NormalTok{(rand\_eff),}
  \AttributeTok{slope      =}\NormalTok{ b\_fix }\SpecialCharTok{+}\NormalTok{ rand\_slope,}
  \AttributeTok{slope\_SD   =}\NormalTok{ rand\_slope\_sd,}
  \AttributeTok{lower      =}\NormalTok{ slope }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ slope\_SD,}
  \AttributeTok{upper      =}\NormalTok{ slope }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ slope\_SD}
\NormalTok{)}

\NormalTok{pop\_slopes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 23 x 5
##    pop    slope slope_SD   lower upper
##    <chr>  <dbl>    <dbl>   <dbl> <dbl>
##  1 BH    0.259    0.0784  0.105  0.412
##  2 CC    0.0791   0.0784 -0.0746 0.233
##  3 CP2   0.0601   0.0784 -0.0936 0.214
##  4 DPR   0.0994   0.0784 -0.0543 0.253
##  5 FR    0.0591   0.0784 -0.0946 0.213
##  6 IH    0.0484   0.0784 -0.105  0.202
##  7 LV1   0.0735   0.0784 -0.0802 0.227
##  8 LV3   0.0320   0.0784 -0.122  0.186
##  9 LVTR  0.0690   0.0784 -0.0848 0.223
## 10 LVTR1 0.0270   0.0784 -0.127  0.181
## # i 13 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 5. Plot}
\NormalTok{UCD\_slope }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pop\_slopes,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(pop, slope), }\AttributeTok{y =}\NormalTok{ slope)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_pointrange}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ lower, }\AttributeTok{ymax =}\NormalTok{ upper)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"UCD: Population{-}specific slopes (95\% CI)"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Population"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Slope (cm/day per Ly/day)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

WL2

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plant }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"Data/WL2{-}2023\_Size\_Combined.csv"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survey\_date =} \FunctionTok{as.Date}\NormalTok{(survey\_date, }\AttributeTok{format =} \StringTok{"\%m/\%d/\%Y"}\NormalTok{))}
\CommentTok{\#PID}
\NormalTok{plant\_growth }\OtherTok{\textless{}{-}}\NormalTok{ plant }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unite}\NormalTok{(}\StringTok{"PID"}\NormalTok{, genotype}\SpecialCharTok{:}\NormalTok{rep, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{, }\AttributeTok{remove =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survey\_date =} \FunctionTok{as.Date}\NormalTok{(survey\_date))}
\CommentTok{\#filter out plants with negative growth \textless{} {-}5}
\NormalTok{plant\_growth\_cleaned }\OtherTok{\textless{}{-}}\NormalTok{ plant\_growth}

\ControlFlowTok{repeat}\NormalTok{ \{}
\NormalTok{  plant\_growth\_cleaned }\OtherTok{\textless{}{-}}\NormalTok{ plant\_growth\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{growth =}\NormalTok{ height\_cm }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(height\_cm)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(growth) }\SpecialCharTok{|}\NormalTok{ growth }\SpecialCharTok{\textgreater{}=} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{growth) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{  check }\OtherTok{\textless{}{-}}\NormalTok{ plant\_growth\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{growth =}\NormalTok{ height\_cm }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(height\_cm)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(growth }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(check) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\ControlFlowTok{break}
\NormalTok{\}}
\CommentTok{\#define daily growth rate}
\NormalTok{plant\_growth\_daily }\OtherTok{\textless{}{-}}\NormalTok{ plant\_growth\_cleaned }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(PID, survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(PID) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{prev\_height =} \FunctionTok{lag}\NormalTok{(height\_cm),}
    \AttributeTok{prev\_date =} \FunctionTok{lag}\NormalTok{(survey\_date),}
    \AttributeTok{days\_elapsed =} \FunctionTok{as.numeric}\NormalTok{(survey\_date }\SpecialCharTok{{-}}\NormalTok{ prev\_date),}
    \AttributeTok{daily\_growth =}\NormalTok{ (height\_cm }\SpecialCharTok{{-}}\NormalTok{ prev\_height) }\SpecialCharTok{/}\NormalTok{ days\_elapsed}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}
\CommentTok{\#Align plant growth data to week}
\NormalTok{plant\_weekly }\OtherTok{\textless{}{-}}\NormalTok{ plant\_growth\_daily }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(daily\_growth), days\_elapsed }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{week =} \FunctionTok{floor\_date}\NormalTok{(survey\_date, }\StringTok{"week"}\NormalTok{))}

\CommentTok{\#Adds \textasciigrave{}weekly\_avg\_SlrW\textasciigrave{} to plant data}
\NormalTok{plant\_with\_light }\OtherTok{\textless{}{-}}\NormalTok{ plant\_weekly }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(wl2\_weekly, }\AttributeTok{by =} \StringTok{"week"}\NormalTok{)}

\CommentTok{\#Standardization}
\NormalTok{plant\_with\_light}\SpecialCharTok{$}\NormalTok{weekly\_avg\_SlrW2 }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(plant\_with\_light}\SpecialCharTok{$}\NormalTok{weekly\_avg\_SlrW, }\AttributeTok{center =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{mean\_light }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(plant\_with\_light}\SpecialCharTok{$}\NormalTok{weekly\_avg\_SlrW, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{sd\_light   }\OtherTok{\textless{}{-}} \FunctionTok{sd}\NormalTok{(plant\_with\_light}\SpecialCharTok{$}\NormalTok{weekly\_avg\_SlrW, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\#Change Data type}
\NormalTok{plant\_with\_light }\OtherTok{\textless{}{-}}\NormalTok{ plant\_with\_light }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{parent\_pop =} \FunctionTok{factor}\NormalTok{(parent\_pop),}
    \AttributeTok{PID        =} \FunctionTok{factor}\NormalTok{(PID),}
    \AttributeTok{block      =} \FunctionTok{factor}\NormalTok{(block)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plant\_with\_light }\OtherTok{\textless{}{-}}\NormalTok{ plant\_with\_light }\SpecialCharTok{\%\textgreater{}\%}
\FunctionTok{arrange}\NormalTok{(survey\_date) }\SpecialCharTok{\%\textgreater{}\%}
\FunctionTok{mutate}\NormalTok{(}
\AttributeTok{week =} \FunctionTok{as.integer}\NormalTok{((}\FunctionTok{as.numeric}\NormalTok{(survey\_date }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(survey\_date)) }\SpecialCharTok{\%/\%} \DecValTok{7}\NormalTok{) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\NormalTok{)}
\NormalTok{plant\_with\_light}\SpecialCharTok{$}\NormalTok{week\_f }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(plant\_with\_light}\SpecialCharTok{$}\NormalTok{week)}
\NormalTok{growth\_light\_time.lmer }\OtherTok{\textless{}{-}} \FunctionTok{lmer}\NormalTok{(}
\NormalTok{daily\_growth }\SpecialCharTok{\textasciitilde{}}\NormalTok{ weekly\_avg\_SlrW2 }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ weekly\_avg\_SlrW2 }\SpecialCharTok{|}\NormalTok{ parent\_pop) }\SpecialCharTok{+}\NormalTok{ (week}\SpecialCharTok{|}\NormalTok{parent\_pop),}
\AttributeTok{data =}\NormalTok{ plant\_with\_light, }\AttributeTok{REML =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.0152085 (tol = 0.002, component 1)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(growth\_light\_time.lmer)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Linear mixed model fit by REML ['lmerMod']
## Formula: 
## daily_growth ~ weekly_avg_SlrW2 + (1 + weekly_avg_SlrW2 | parent_pop) +  
##     (week | parent_pop)
##    Data: plant_with_light
## 
## REML criterion at convergence: -6476.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -6.1033 -0.4732 -0.0083  0.4445  8.4528 
## 
## Random effects:
##  Groups       Name             Variance  Std.Dev. Corr 
##  parent_pop   (Intercept)      8.810e-04 0.029682      
##               weekly_avg_SlrW2 2.302e-04 0.015174 -0.71
##  parent_pop.1 (Intercept)      3.285e-03 0.057318      
##               week             4.961e-05 0.007043 -0.90
##  Residual                      1.897e-02 0.137726      
## Number of obs: 5870, groups:  parent_pop, 22
## 
## Fixed effects:
##                  Estimate Std. Error t value
## (Intercept)      0.016004   0.008509   1.881
## weekly_avg_SlrW2 0.017808   0.004177   4.263
## 
## Correlation of Fixed Effects:
##             (Intr)
## wkly_vg_SW2 -0.398
## optimizer (nloptwrap) convergence code: 0 (OK)
## Model failed to converge with max|grad| = 0.0152085 (tol = 0.002, component 1)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b\_fix }\OtherTok{\textless{}{-}} \FunctionTok{fixef}\NormalTok{(growth\_light\_time.lmer)[}\StringTok{"weekly\_avg\_SlrW2"}\NormalTok{]}

\NormalTok{re }\OtherTok{\textless{}{-}} \FunctionTok{ranef}\NormalTok{(growth\_light\_time.lmer)}\SpecialCharTok{$}\NormalTok{parent\_pop}
\NormalTok{rand\_slope }\OtherTok{\textless{}{-}}\NormalTok{ re[, }\StringTok{"weekly\_avg\_SlrW2"}\NormalTok{, drop }\OtherTok{=} \ConstantTok{TRUE}\NormalTok{]}

\NormalTok{vc\_mat  }\OtherTok{\textless{}{-}} \FunctionTok{VarCorr}\NormalTok{(growth\_light\_time.lmer)}\SpecialCharTok{$}\NormalTok{parent\_pop}
\NormalTok{sl\_col  }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(vc\_mat) }\SpecialCharTok{==} \StringTok{"weekly\_avg\_SlrW2"}\NormalTok{)}
\NormalTok{rand\_slope\_sd }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(vc\_mat, }\StringTok{"stddev"}\NormalTok{)[sl\_col]}

\NormalTok{pop\_slope }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{Population =} \FunctionTok{rownames}\NormalTok{(re),}
  \AttributeTok{slope      =} \FunctionTok{as.numeric}\NormalTok{(b\_fix }\SpecialCharTok{+}\NormalTok{ rand\_slope),       }\CommentTok{\# cm/day per W/m\^{}2}
  \AttributeTok{slope\_SD   =}\NormalTok{ rand\_slope\_sd,}
  \AttributeTok{lower      =}\NormalTok{ slope }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ slope\_SD,}
  \AttributeTok{upper      =}\NormalTok{ slope }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ slope\_SD}
\NormalTok{)}
\NormalTok{sd\_light }\OtherTok{\textless{}{-}} \FunctionTok{sd}\NormalTok{(plant\_with\_light[[}\StringTok{"weekly\_avg\_SlrW2"}\NormalTok{]], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{pop\_slope\_std }\OtherTok{\textless{}{-}}\NormalTok{ pop\_slope }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{slope\_per\_Wm2 =}\NormalTok{ slope }\SpecialCharTok{/}\NormalTok{ sd\_light,}
    \AttributeTok{lower\_per\_Wm2 =}\NormalTok{ lower }\SpecialCharTok{/}\NormalTok{ sd\_light,}
    \AttributeTok{upper\_per\_Wm2 =}\NormalTok{ upper }\SpecialCharTok{/}\NormalTok{ sd\_light}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(slope\_per\_Wm2)}

\NormalTok{WL2\_slope }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pop\_slope,}
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ slope,}
           \AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(Population, slope))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_errorbarh}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }\AttributeTok{xmax =}\NormalTok{ upper), }\AttributeTok{height =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"WL2: Population{-}specific slopes with 95\% CI"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"Slope (cm/day per Ly/day)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Population"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(patchwork)}
\NormalTok{UCD\_slope}\SpecialCharTok{+}\NormalTok{WL2\_slope}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{FQ3_files/figure-latex/unnamed-chunk-25-1.pdf}}

\end{document}
